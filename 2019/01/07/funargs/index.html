<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>funargs | Just Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一路走来。很多东西都是随性而写。很多问题，并未能理解的深刻。问题就像递归一下，要解释这个问题，不得不去解释另一个问题；也怪自己不能很合适的抽象。 今天又是一个乱炖。 function arguments12345function yes()&amp;#123;&amp;#125;function no()&amp;#123;&amp;#125;function yesno(no, yes)&amp;#123; return yes;&amp;#">
<meta name="keywords" content="JavaScript">
<meta property="og:type" content="article">
<meta property="og:title" content="funargs">
<meta property="og:url" content="https://lxl1986.github.io/2019/01/07/funargs/index.html">
<meta property="og:site_name" content="Just Blog">
<meta property="og:description" content="一路走来。很多东西都是随性而写。很多问题，并未能理解的深刻。问题就像递归一下，要解释这个问题，不得不去解释另一个问题；也怪自己不能很合适的抽象。 今天又是一个乱炖。 function arguments12345function yes()&amp;#123;&amp;#125;function no()&amp;#123;&amp;#125;function yesno(no, yes)&amp;#123; return yes;&amp;#">
<meta property="og:locale" content="zh">
<meta property="og:image" content="https://lxl1986.github.io/2019/01/07/funargs/haha1.png">
<meta property="og:image" content="https://lxl1986.github.io/2019/01/07/funargs/haha2.png">
<meta property="og:image" content="https://lxl1986.github.io/2019/01/07/funargs/haha3.png">
<meta property="og:image" content="https://lxl1986.github.io/2019/01/07/funargs/haha4.png">
<meta property="og:image" content="https://lxl1986.github.io/2019/01/07/funargs/haha5.png">
<meta property="og:updated_time" content="2019-01-16T09:19:38.204Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="funargs">
<meta name="twitter:description" content="一路走来。很多东西都是随性而写。很多问题，并未能理解的深刻。问题就像递归一下，要解释这个问题，不得不去解释另一个问题；也怪自己不能很合适的抽象。 今天又是一个乱炖。 function arguments12345function yes()&amp;#123;&amp;#125;function no()&amp;#123;&amp;#125;function yesno(no, yes)&amp;#123; return yes;&amp;#">
<meta name="twitter:image" content="https://lxl1986.github.io/2019/01/07/funargs/haha1.png">
  
    <link rel="alternate" href="/atom.xml" title="Just Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Just Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">None</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://lxl1986.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-funargs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/07/funargs/" class="article-date">
  <time datetime="2019-01-07T01:03:59.000Z" itemprop="datePublished">2019-01-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      funargs
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一路走来。很多东西都是随性而写。很多问题，并未能理解的深刻。问题就像递归一下，要解释这个问题，不得不去解释另一个问题；也怪自己不能很合适的抽象。</p>
<p>今天又是一个乱炖。</p>
<h2 id="function-arguments"><a href="#function-arguments" class="headerlink" title="function arguments"></a>function arguments</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yes</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">no</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yesno</span>(<span class="params">no, yes</span>)</span>&#123; <span class="keyword">return</span> yes;&#125;</span><br><span class="line"></span><br><span class="line">yesno(yes, no);</span><br></pre></td></tr></table></figure>
<p>函数就是一个值，可以做参数，也可以当返回值。也因此，在JavaScript中，<strong>函数参数</strong>大行其道，尤其是 callback，无处不在。 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"window was clicked!"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>再举一个栗子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job1</span>(<span class="params"></span>) </span>&#123;<span class="built_in">console</span>.log(<span class="string">"job1 !!!"</span>);&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job2</span>(<span class="params"></span>) </span>&#123;<span class="built_in">console</span>.log(<span class="string">"job2 !!!"</span>);&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job3</span>(<span class="params"></span>) </span>&#123;<span class="built_in">console</span>.log(<span class="string">"job3 !!!"</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jobs</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"jobs ..."</span>);	</span><br><span class="line">	cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jobs(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	job1();</span><br><span class="line">	jobs(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		job2();</span><br><span class="line">		jobs(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			job3();</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>我也不知道为啥举了这个栗子，哎。人家都说回调多了，就进了地狱，我就是尝试一下地狱。</p>
<h2 id="复制粘贴大法好"><a href="#复制粘贴大法好" class="headerlink" title="复制粘贴大法好"></a>复制粘贴大法好</h2><p><a href="https://developer.mozilla.org/en-US/docs/Glossary/Callback_function" target="_blank" rel="noopener">Callback function</a> A callback function is a function passed into another function as an argument, which is then invoked inside the outer function to complete some kind of routine or action.</p>
<h3 id="粘贴一些小的知识点"><a href="#粘贴一些小的知识点" class="headerlink" title="粘贴一些小的知识点"></a>粘贴一些小的知识点</h3><p>打开 谷歌浏览器的 console。我们来看点东西。我这里是<strong>一句一句执行</strong>的。 </p>
<img src="/2019/01/07/funargs/haha1.png" title="haha1">
<p>没毛病。haha的 Scopes 只有 Global，我这里没有定义 t。</p>
<img src="/2019/01/07/funargs/haha2.png" title="haha2">
<p>擦！haha的 Scopes 变了，[Script, Global]。这就是 let 搞得鬼。let 偷偷修改了作用域。（const 同理）</p>
<img src="/2019/01/07/funargs/haha3.png" title="haha3">
<p>这也就是为什么 t 有值，但是在 this 中找不到！！！</p>
<p>上面说了 let 偷偷修改了作用域，不仅仅是新建作用域这么简单<br><img src="/2019/01/07/funargs/haha4.png" title="haha4"></p>
<p>下图中，Scopes 多了 Block。第一个函数是被优化了，两个其实应该是一样的。作用域链上没用到的，谷歌浏览器直接踢了。<br><img src="/2019/01/07/funargs/haha5.png" title="haha5"></p>
<p>为毛一个多了 Script，一个多了 Block；简而言之，一个是修改，一个是新建（未来会不会有什么变化，到时再看）。这里没有谈及其他的特性，Scoping，TDZ，redeclaration。你以为新语法只有好处拿？？？不得不说，带来了不少新的问题。有空再搞一搞吧。请访问化学家兼计算机科学家的<a href="https://www.web-tinker.com/article/21348.html" target="_blank" rel="noopener">const 和 let 到底定义到哪儿去了？</a><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> t = <span class="string">"go"</span>;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">ttt</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> t;&#125;</span></span><br><span class="line"><span class="javascript"><span class="built_in">console</span>.dir(ttt);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">&#123;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">let</span> t = <span class="string">"go"</span>;</span></span><br><span class="line"><span class="javascript">	<span class="function"><span class="keyword">function</span> <span class="title">ttt</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> t;&#125;</span></span><br><span class="line"><span class="javascript">	<span class="built_in">console</span>.dir(ttt);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>JS代码所处的环境就像这样 <code>Global.cpp_initialize(/** **/)</code>，这一句是外界（浏览器？ JSVM？对不起，我不知道）提供，换句话说，我们的这些代码也处在一个外界提供的作用域；由外界提供 this，浏览器中就是 window。</p>
</blockquote>
<p>我以前说过 <strong>this</strong> is not important ，是想说，很多时候你就不必关心 this 。arrow functions 还想探究一下；还是算了，扯着扯着就扯到蛋了，越来越远。感觉又挖坑了！我今天是来搞 function 的，callback 的。打算改写下 callback 的样子。</p>
<h2 id="从网上搜了不少文章，谢谢各位前辈，写下自己的理解。"><a href="#从网上搜了不少文章，谢谢各位前辈，写下自己的理解。" class="headerlink" title="从网上搜了不少文章，谢谢各位前辈，写下自己的理解。"></a>从网上搜了不少文章，谢谢各位前辈，写下自己的理解。</h2><p>(写代码好吃力，各种错误；去网上粘点吧)</p>
<p>这里，我先发送一个请求，完了再发送第二个请求。（辣鸡代码，未处理异常，慎重！）</p>
<ol>
<li>callback<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url1 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"><span class="keyword">var</span> url2 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">url, f</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();	</span><br><span class="line">	xhr.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">		f(xhr.response);</span><br><span class="line">	&#125;);</span><br><span class="line">	xhr.responseType = <span class="string">"json"</span>;</span><br><span class="line">	xhr.open(<span class="string">'get'</span>, url);</span><br><span class="line">	xhr.send();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request(url1, <span class="function"><span class="keyword">function</span> <span class="title">cb1</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"1st: %o"</span>, r);</span><br><span class="line">	request(url2, <span class="function"><span class="keyword">function</span> <span class="title">cb2</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"2nd: %o"</span>, r);</span><br><span class="line">		<span class="comment">// request(url3, function cb3() &#123;&#125;);</span></span><br><span class="line">	&#125;);	</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>如果想依次发多个请求，把自己就回调进去了，真是焦头烂额。</p>
<ol start="2">
<li>promise<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url1 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"><span class="keyword">const</span> url2 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestP</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">s, f</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();	</span><br><span class="line">		xhr.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">			s(xhr.response);</span><br><span class="line">		&#125;);		</span><br><span class="line">		xhr.responseType = <span class="string">"json"</span>;</span><br><span class="line">		xhr.open(<span class="string">'get'</span>, url);</span><br><span class="line">		xhr.send();</span><br><span class="line">	&#125;);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requestP(url1)</span><br><span class="line">	.then(<span class="function"><span class="params">v</span>=&gt;</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"1st: %o"</span>, v); </span><br><span class="line">		<span class="keyword">return</span> requestP(url2);</span><br><span class="line">	&#125;)</span><br><span class="line">	.then(<span class="function"><span class="params">v</span>=&gt;</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"2nd: %o"</span>, v)</span><br><span class="line">		<span class="comment">// return requestP(url3);</span></span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>这样就把 回调 放在 then 里面了。 // 看了一眼别人的代码，哦，懂了。自己写起来，半天挤不出来。唉……</p>
<ol start="3">
<li>generator<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url1 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"><span class="keyword">const</span> url2 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestN</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();	</span><br><span class="line">	xhr.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">		<span class="comment">//console.log(xhr.response);</span></span><br><span class="line">		rg.next(xhr.response);<span class="comment">/*我们再次启动 rg，并把结果塞回去*/</span></span><br><span class="line">	&#125;);</span><br><span class="line">	xhr.responseType = <span class="string">"json"</span>;</span><br><span class="line">	xhr.open(<span class="string">'get'</span>, url);</span><br><span class="line">	xhr.send();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">requestG</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> r1 = <span class="keyword">yield</span> requestN(url1);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"1st: %o"</span>, r1);</span><br><span class="line">	<span class="keyword">let</span> r2 = <span class="keyword">yield</span> requestN(url2);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"2nd: %o"</span>, r2);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	let r3 = yield requestN(url3);</span></span><br><span class="line"><span class="comment">	console.log("3rd: %o", r3);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rg = requestG();</span><br><span class="line">rg.next(); <span class="comment">// 启动</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>rg 执行到了 yield 那里，就会计算后面的表达式，然后吐出一个这样的对象 <code>{value: 值, done: false}</code>，rg 就休息了（我也感觉困了）；当 xhr load 以后，执行语句 rg.next(xhr.response)，就会再次唤醒 rg ，并且 yield 返回值就是此时传进去的参数，也就是说把 xhr.response 给了 r1；下次遇到 yield ，rg 又歇菜了。 （至于 rg.throw，rg.return 是干嘛的，我还没用过呢。）</p>
<p>简单说，yield 先要吐出来一个值；再次使用 next 启动时，yield 还要返回一个值，这货还脚踩两只船。吐出来的值（吐一个promise也行，吐一个函数也行），我们这里没用到；我们这里就只利用了 yield 返回值，也就是我们再次启动时，传进去的值，这样才能把结果给 r1、r2。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url1 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"><span class="keyword">const</span> url2 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestP</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">s, f</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();	</span><br><span class="line">		xhr.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">			s(xhr.response);</span><br><span class="line">		&#125;);		</span><br><span class="line">		xhr.responseType = <span class="string">"json"</span>;</span><br><span class="line">		xhr.open(<span class="string">'get'</span>, url);</span><br><span class="line">		xhr.send();</span><br><span class="line">	&#125;);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">requestG</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> r1 = <span class="keyword">yield</span> requestP(url1);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"1st: %o"</span>, r1);</span><br><span class="line">	<span class="keyword">let</span> r2 = <span class="keyword">yield</span> requestP(url2);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"2nd: %o"</span>, r2);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	let r3 = yield requestP(url3);</span></span><br><span class="line"><span class="comment">	console.log("3rd: %o", r3);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rg = requestG();</span><br><span class="line"><span class="keyword">let</span> p = rg.next(); <span class="comment">// 启动</span></span><br><span class="line"></span><br><span class="line">p.value <span class="comment">// p 是 yield 吐出来的 &#123;value: promise, done: false&#125;，我们取 promise。</span></span><br><span class="line">	.then(<span class="function"><span class="params">v</span>=&gt;</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"give result to r1"</span>);</span><br><span class="line">		<span class="keyword">let</span> p = rg.next(v);</span><br><span class="line">		<span class="keyword">return</span> p.value;</span><br><span class="line">	&#125;)</span><br><span class="line">	.then(<span class="function"><span class="params">v</span>=&gt;</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"give result to r2"</span>);</span><br><span class="line">		<span class="keyword">let</span> p = rg.next(v);</span><br><span class="line">		<span class="keyword">return</span> p.value;</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>
<p>代码写的虽然和狗屎一样，但是这次 yield 吐出了一个 promise 的值，（上此吐出来的值，我们并未在意）。我们在 then 中 调用了 next 方法，再次启动 generator，启动的时机不同。</p>
<ol start="4">
<li>async/await<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url1 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"><span class="keyword">const</span> url2 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestP</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">s, f</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();	</span><br><span class="line">		xhr.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</span><br><span class="line">			s(xhr.response);</span><br><span class="line">		&#125;);		</span><br><span class="line">		xhr.responseType = <span class="string">"json"</span>;</span><br><span class="line">		xhr.open(<span class="string">'get'</span>, url);</span><br><span class="line">		xhr.send();</span><br><span class="line">	&#125;);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">requestA</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> r1 = <span class="keyword">await</span> requestP(url1);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"1st: %o"</span>, r1);</span><br><span class="line">	<span class="keyword">let</span> r2 = <span class="keyword">await</span> requestP(url2);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"2nd: %o"</span>, r2);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	let r3 = await requestP(url3);</span></span><br><span class="line"><span class="comment">	console.log("3rd: %o", r3);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requestA();</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>await 和 yield 很像，不过更过分。 await “等到”了完成了的 Promise，就会再次启动，并把值返回。</p>
<p>这四个功能基本相同，但写法却有很大不同，主要是越来越简洁清晰，爽快。</p>
<h2 id="yield；-next"><a href="#yield；-next" class="headerlink" title="yield； next"></a>yield； next</h2><p>看看它们的嘴脸。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="built_in">Function</span>; <span class="comment">// Don't worry, be happy!</span></span><br><span class="line"><span class="built_in">Function</span> = <span class="built_in">Object</span>.getPrototypeOf(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;).constructor; <span class="comment">//这些内置对象，不在三界五行之中。你看它的“定义域”就知道了。</span></span><br><span class="line">GeneratorFunction = <span class="built_in">Object</span>.getPrototypeOf(<span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>&#123;&#125;).constructor;</span><br><span class="line">AsyncFunction = <span class="built_in">Object</span>.getPrototypeOf(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;).constructor;</span><br><span class="line">AsyncGeneratorFunction = <span class="built_in">Object</span>.getPrototypeOf(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;&#125;).constructor;</span><br></pre></td></tr></table></figure></p>
<p>关于generator的自动执行。 yield 吐出来的那个值，在这个值完成了相关任务后，调用 next(result) 再返回结果。具体参考 <strong>co</strong> 库（听别人说的）。如今还是连字符串操作都不熟练，没心思吹了，打基础去了。</p>
<p>突然想到了这几个 request 函数，比如第一个。request执行了，内部 xhr 去哪里了？虽然上面挂着 load 事件。惊出了我一身冷汗，我再仔细想想。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">url, f</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();	</span><br><span class="line">	xhr.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123; <span class="comment">// 这个函数定义时候，引用了 xhr。 内存是否会泄露？</span></span><br><span class="line">		f(xhr.response);</span><br><span class="line">		xhr = <span class="literal">null</span>; <span class="comment">// 这样是否会好点？</span></span><br><span class="line">	&#125;);</span><br><span class="line">	xhr.responseType = <span class="string">"json"</span>;</span><br><span class="line">	xhr.open(<span class="string">'get'</span>, url);</span><br><span class="line">	xhr.send();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>成天就知道玩弄概念。还是该多练。熟能生巧。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++) &#123;</span><br><span class="line">	setTimeout(<span class="function"><span class="params">v</span>=&gt;</span><span class="built_in">console</span>.log(i),); <span class="comment">// v没啥用，我就是不想打那俩个括号</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> url1 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"><span class="keyword">var</span> url2 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">url, f</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();	</span><br><span class="line">	xhr.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">		f(xhr.response);</span><br><span class="line">	&#125;);</span><br><span class="line">	xhr.responseType = <span class="string">"json"</span>;</span><br><span class="line">	xhr.open(<span class="string">'get'</span>, url);</span><br><span class="line">	xhr.send();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request(url1, <span class="function"><span class="keyword">function</span> <span class="title">cb1</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.warn(<span class="string">"1st: %o"</span>, r);</span><br><span class="line">	request(url2, <span class="function"><span class="keyword">function</span> <span class="title">cb2</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.warn(<span class="string">"2nd: %o"</span>, r);</span><br><span class="line">		<span class="comment">// request(url3, function cb3() &#123;&#125;);</span></span><br><span class="line">	&#125;);	</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>先放一万个事件到队列。看结果，xhr 是在半路输出的，插队了。 xhr 很及时，也可能和 timeout 不在一个队列。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lxl1986.github.io/2019/01/07/funargs/" data-id="cjrikmcf2000zk4v9l4ktk5l4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/01/17/checkbox-notes/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          checkbox notes
        
      </div>
    </a>
  
  
    <a href="/2019/01/03/key-key/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">key? key!</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/execution-context/">execution context</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/prototype/">prototype</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cryptography/">cryptography</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/events/">events</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/events-load/">events load</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/height/">height</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scroll/">scroll</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selector/">selector</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/server/">server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/viewport/">viewport</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/不知所云/">不知所云</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/animation/" style="font-size: 10px;">animation</a> <a href="/tags/cryptography/" style="font-size: 10px;">cryptography</a> <a href="/tags/css/" style="font-size: 16.67px;">css</a> <a href="/tags/events/" style="font-size: 13.33px;">events</a> <a href="/tags/events-load/" style="font-size: 10px;">events load</a> <a href="/tags/height/" style="font-size: 10px;">height</a> <a href="/tags/scroll/" style="font-size: 10px;">scroll</a> <a href="/tags/selector/" style="font-size: 10px;">selector</a> <a href="/tags/server/" style="font-size: 10px;">server</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/viewport/" style="font-size: 10px;">viewport</a> <a href="/tags/不知所云/" style="font-size: 13.33px;">不知所云</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/01/29/tween-haha/">tween, haha</a>
          </li>
        
          <li>
            <a href="/2019/01/24/scrollLeft/">scrollLeft</a>
          </li>
        
          <li>
            <a href="/2019/01/21/a-little-note-about-load-event/">a little note about load event</a>
          </li>
        
          <li>
            <a href="/2019/01/18/event-fired/">event fired?</a>
          </li>
        
          <li>
            <a href="/2019/01/17/checkbox-notes/">checkbox notes</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 李小利<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>