<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Just Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="None">
<meta name="keywords" content="None">
<meta property="og:type" content="website">
<meta property="og:title" content="Just Blog">
<meta property="og:url" content="https://lxl1986.github.io/index.html">
<meta property="og:site_name" content="Just Blog">
<meta property="og:description" content="None">
<meta property="og:locale" content="zh">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Just Blog">
<meta name="twitter:description" content="None">
  
    <link rel="alternate" href="/atom.xml" title="Just Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Just Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">None</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://lxl1986.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-funargs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/07/funargs/" class="article-date">
  <time datetime="2019-01-07T01:03:59.000Z" itemprop="datePublished">2019-01-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/07/funargs/">funargs</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一路走来。很多东西都是随性而写。很多问题，并未能理解的深刻。问题就像递归一下，要解释这个问题，不得不去解释另一个问题；也怪自己不能很合适的抽象。</p>
<p>今天又是一个乱炖。</p>
<h2 id="function-arguments"><a href="#function-arguments" class="headerlink" title="function arguments"></a>function arguments</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yes</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">no</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yesno</span>(<span class="params">no, yes</span>)</span>&#123; <span class="keyword">return</span> yes;&#125;</span><br><span class="line"></span><br><span class="line">yesno(yes, no);</span><br></pre></td></tr></table></figure>
<p>函数就是一个值，可以做参数，也可以当返回值。也因此，在JavaScript中，<strong>函数参数</strong>大行其道，尤其是 callback，无处不在。 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"window was clicked!"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>再举一个栗子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job1</span>(<span class="params"></span>) </span>&#123;<span class="built_in">console</span>.log(<span class="string">"job1 !!!"</span>);&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job2</span>(<span class="params"></span>) </span>&#123;<span class="built_in">console</span>.log(<span class="string">"job2 !!!"</span>);&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job3</span>(<span class="params"></span>) </span>&#123;<span class="built_in">console</span>.log(<span class="string">"job3 !!!"</span>);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jobs</span>(<span class="params">cb</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"jobs ..."</span>);	</span><br><span class="line">	cb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jobs(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	job1();</span><br><span class="line">	jobs(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		job2();</span><br><span class="line">		jobs(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			job3();</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>我也不知道为啥举了这个栗子，哎。人家都说回调多了，就进了地狱，我就是尝试一下地狱。</p>
<h2 id="复制粘贴大法好"><a href="#复制粘贴大法好" class="headerlink" title="复制粘贴大法好"></a>复制粘贴大法好</h2><p><a href="https://developer.mozilla.org/en-US/docs/Glossary/Callback_function" target="_blank" rel="noopener">Callback function</a> A callback function is a function passed into another function as an argument, which is then invoked inside the outer function to complete some kind of routine or action.</p>
<h3 id="粘贴一些小的知识点"><a href="#粘贴一些小的知识点" class="headerlink" title="粘贴一些小的知识点"></a>粘贴一些小的知识点</h3><p>打开 谷歌浏览器的 console。我们来看点东西。我这里是<strong>一句一句执行</strong>的。 </p>
<img src="/2019/01/07/funargs/haha1.png" title="haha1">
<p>没毛病。haha的 Scopes 只有 Global，我这里没有定义 t。</p>
<img src="/2019/01/07/funargs/haha2.png" title="haha2">
<p>擦！haha的 Scopes 变了，[Script, Global]。这就是 let 搞得鬼。let 偷偷修改了作用域。（const 同理）</p>
<img src="/2019/01/07/funargs/haha3.png" title="haha3">
<p>这也就是为什么 t 有值，但是在 this 中找不到！！！</p>
<p>上面说了 let 偷偷修改了作用域，不仅仅是新建作用域这么简单<br><img src="/2019/01/07/funargs/haha4.png" title="haha4"></p>
<p>下图中，Scopes 多了 Block。第一个函数是被优化了，两个其实应该是一样的。作用域链上没用到的，谷歌浏览器直接踢了。<br><img src="/2019/01/07/funargs/haha5.png" title="haha5"></p>
<p>为毛一个多了 Script，一个多了 Block；简而言之，一个是修改，一个是新建（未来会不会有什么变化，到时再看）。这里没有谈及其他的特性，Scoping，TDZ，redeclaration。你以为新语法只有好处拿？？？不得不说，带来了不少新的问题。有空再搞一搞吧。请访问化学家兼计算机科学家的<a href="https://www.web-tinker.com/article/21348.html" target="_blank" rel="noopener">const 和 let 到底定义到哪儿去了？</a><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">let</span> t = <span class="string">"go"</span>;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">ttt</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> t;&#125;</span></span><br><span class="line"><span class="javascript"><span class="built_in">console</span>.dir(ttt);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">&#123;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">let</span> t = <span class="string">"go"</span>;</span></span><br><span class="line"><span class="javascript">	<span class="function"><span class="keyword">function</span> <span class="title">ttt</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> t;&#125;</span></span><br><span class="line"><span class="javascript">	<span class="built_in">console</span>.dir(ttt);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>JS代码所处的环境就像这样 <code>Global.cpp_initialize(/** **/)</code>，这一句是外界（浏览器？ JSVM？对不起，我不知道）提供，换句话说，我们的这些代码也处在一个外界提供的作用域；由外界提供 this，浏览器中就是 window。</p>
</blockquote>
<p>我以前说过 <strong>this</strong> is not important ，是想说，很多时候你就不必关心 this 。arrow functions 还想探究一下；还是算了，扯着扯着就扯到蛋了，越来越远。感觉又挖坑了！我今天是来搞 function 的，callback 的。打算改写下 callback 的样子。</p>
<h2 id="从网上搜了不少文章，谢谢各位前辈，写下自己的理解。"><a href="#从网上搜了不少文章，谢谢各位前辈，写下自己的理解。" class="headerlink" title="从网上搜了不少文章，谢谢各位前辈，写下自己的理解。"></a>从网上搜了不少文章，谢谢各位前辈，写下自己的理解。</h2><p>(写代码好吃力，各种错误；去网上粘点吧)</p>
<p>这里，我先发送一个请求，完了再发送第二个请求。（辣鸡代码，未处理异常，慎重！）</p>
<ol>
<li>callback<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url1 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"><span class="keyword">var</span> url2 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">url, f</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();	</span><br><span class="line">	xhr.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">		f(xhr.response);</span><br><span class="line">	&#125;);</span><br><span class="line">	xhr.responseType = <span class="string">"json"</span>;</span><br><span class="line">	xhr.open(<span class="string">'get'</span>, url);</span><br><span class="line">	xhr.send();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request(url1, <span class="function"><span class="keyword">function</span> <span class="title">cb1</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"1st: %o"</span>, r);</span><br><span class="line">	request(url2, <span class="function"><span class="keyword">function</span> <span class="title">cb2</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"2nd: %o"</span>, r);</span><br><span class="line">		<span class="comment">// request(url3, function cb3() &#123;&#125;);</span></span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>如果想依次发多个请求，把自己就回调进去了，真是焦头烂额。</p>
<ol start="2">
<li>promise<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url1 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"><span class="keyword">const</span> url2 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestP</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">s, f</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();	</span><br><span class="line">		xhr.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">			s(xhr.response);</span><br><span class="line">		&#125;);		</span><br><span class="line">		xhr.responseType = <span class="string">"json"</span>;</span><br><span class="line">		xhr.open(<span class="string">'get'</span>, url);</span><br><span class="line">		xhr.send();</span><br><span class="line">	&#125;);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requestP(url1)</span><br><span class="line">	.then(<span class="function"><span class="params">v</span>=&gt;</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"1st: %o"</span>, v); </span><br><span class="line">		<span class="keyword">return</span> requestP(url2);</span><br><span class="line">	&#125;)</span><br><span class="line">	.then(<span class="function"><span class="params">v</span>=&gt;</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"2nd: %o"</span>, v)</span><br><span class="line">		<span class="comment">// return requestP(url3);</span></span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>这样就把 回调 放在 then 里面了。 // 看了一眼别人的代码，哦，懂了。自己写起来，半天挤不出来。唉……</p>
<ol start="3">
<li>generator<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url1 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"><span class="keyword">const</span> url2 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestN</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();	</span><br><span class="line">	xhr.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">		<span class="comment">//console.log(xhr.response);</span></span><br><span class="line">		rg.next(xhr.response);<span class="comment">/*我们再次启动 rg，并把结果塞回去*/</span></span><br><span class="line">	&#125;);</span><br><span class="line">	xhr.responseType = <span class="string">"json"</span>;</span><br><span class="line">	xhr.open(<span class="string">'get'</span>, url);</span><br><span class="line">	xhr.send();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">requestG</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> r1 = <span class="keyword">yield</span> requestN(url1);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"1st: %o"</span>, r1);</span><br><span class="line">	<span class="keyword">let</span> r2 = <span class="keyword">yield</span> requestN(url2);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"2nd: %o"</span>, r2);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	let r3 = yield requestN(url3);</span></span><br><span class="line"><span class="comment">	console.log("3rd: %o", r3);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rg = requestG();</span><br><span class="line">rg.next(); <span class="comment">// 启动</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>rg 执行到了 yield 那里，就会计算后面的表达式，然后吐出一个这样的对象 <code>{value: 值, done: false}</code>，就不会往下执行了；当 xhr load 以后，我们 rg.next(xhr.response)，就会再次启动 rg ，并且 yield 返回值就是此时传进去的参数，因此就把 xhr.response 给了 r1；遇到 yield 就会再次暂停。 </p>
<p>简单说，yield 先要吐出来一个值；再次启动时，yield 还要返回一个值，这货还脚踩两只船。吐出来的对象，我们这里没用到；我们这里就只利用了 yield 返回值，也就是我们再次启动时，传进去的值，这样才能把结果给 r1、r2。</p>
<ol start="4">
<li>async/await<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url1 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"><span class="keyword">const</span> url2 = <span class="string">"https://yesno.wtf/api"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestP</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">s, f</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();	</span><br><span class="line">		xhr.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</span><br><span class="line">			s(xhr.response);</span><br><span class="line">		&#125;);		</span><br><span class="line">		xhr.responseType = <span class="string">"json"</span>;</span><br><span class="line">		xhr.open(<span class="string">'get'</span>, url);</span><br><span class="line">		xhr.send();</span><br><span class="line">	&#125;);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">requestA</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> r1 = <span class="keyword">await</span> requestP(url1);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"1st: %o"</span>, r1);</span><br><span class="line">	<span class="keyword">let</span> r2 = <span class="keyword">await</span> requestP(url2);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"2nd: %o"</span>, r2);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	let r3 = await requestP(url3);</span></span><br><span class="line"><span class="comment">	console.log("3rd: %o", r3);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requestA();</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>await 和 yield 很像，不过更过分。 await “等到”了完成了的 Promise，就会再次启动，并把值返回。</p>
<p>这四个功能基本相同，但写法却有很大不同，主要是越来越简洁清晰。</p>
<h2 id="yield；-next"><a href="#yield；-next" class="headerlink" title="yield； next"></a>yield； next</h2><p>看看它们的嘴脸。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="built_in">Function</span>; <span class="comment">// Don't worry, be happy!</span></span><br><span class="line"><span class="built_in">Function</span> = <span class="built_in">Object</span>.getPrototypeOf(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;).constructor; <span class="comment">//这些内置对象，不在三界无形之中。你看它的“定义域”就知道了。</span></span><br><span class="line">GeneratorFunction = <span class="built_in">Object</span>.getPrototypeOf(<span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>&#123;&#125;).constructor;</span><br><span class="line">AsyncFunction = <span class="built_in">Object</span>.getPrototypeOf(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;).constructor;</span><br><span class="line">AsyncGeneratorFunction = <span class="built_in">Object</span>.getPrototypeOf(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;&#125;).constructor;</span><br></pre></td></tr></table></figure></p>
<p>关于generator的自动执行。 yield 吐出来的那个值，在这个值完成了相关任务后，调用 next(result) 再返回结果。具体参考 <strong>co</strong> 库（听别人说的）。如今还是连字符串操作都不熟练，没心思吹了，打基础去了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lxl1986.github.io/2019/01/07/funargs/" data-id="cjqn2rini00038sv9p7f0lw7w" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-key-key" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/03/key-key/" class="article-date">
  <time datetime="2019-01-03T02:25:58.000Z" itemprop="datePublished">2019-01-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/01/03/key-key/">key? key!</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>偷偷摸摸看了阮一峰的<a href="http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html" target="_blank" rel="noopener">数字签名是什么？</a>，评论也都很精彩。小弟也来凑凑热闹，蹭蹭热度。说一下自己的理解，各位尽情可喷。</p>
<p>心中纵有千般疑问，也只能埋在心里。（搞不定数学啊！这里不谈数学，数学太他么难了。）</p>
<p>我觉得要一个一个问题来说。</p>
<h2 id="私钥与公钥"><a href="#私钥与公钥" class="headerlink" title="私钥与公钥"></a>私钥与公钥</h2><p>这个我也不懂，我又不懂数学，我只会用程序生成。不过不要紧，只需记得<strong>它俩天生一对</strong>就行了。啥意思？假设有 【私钥A、公钥A】 和 【私钥B、公钥B】，还有一个字节串（文本文件，二进制文件都是字节串），如果我用 <em>私钥A</em> 加密一下，那么就只能用 <em>公钥A</em> 解密；用 <em>公钥A</em> 加密一下，也只能用 <em>私钥A</em> 解密。不关B什么鸟事。也不知道RSA钥匙空间是个啥情况？我就假设 钥匙对 的唯一性，只有配对才能互解；而这也是为啥可以加密，为啥可以签名的基石。</p>
<p>这里，还有几点说下。</p>
<ul>
<li>什么叫加密，解密？</li>
</ul>
<p>加密就是换了一个形式，解密就是还原。举个栗子，伪代码，<code>RSA_encrypt(bytes, 私钥A) ==&gt; bytes&#39;, RSA_decrypt(bytes&#39;, 公钥A) ==&gt; bytes</code> 。注意，这里加密解密都是用 RSA 相关函数。特别注意 <code>RSA_decrypt(bytes&#39;, 公钥B)</code> 会出错（据说是满足不了一个数学条件）。还有，某些人会用 <code>XXX_decrypt(bytes&#39;, 钥匙C) ==&gt; bytes&#39;&#39;</code> 这个嘛，大哥，我们用的是 RSA，你这个 <code>bytes&#39;&#39;</code>还不如我手动打开 <code>bytes&#39;</code> 在后面添加字节 <code>xxoo</code>，就好像是 <code>decrypt(byptes&#39;, &#39;xxoo&#39;) ==&gt; bytes&#39;&#39;&#39;</code>，我这是手动解密啊，哈哈。不知道说清楚没有？就是说我用RSA的算法加密了一个文件，你却用凯撒算法<strong>“解密”</strong>了一个新文件，说：“我解密了”。字节串变换字节串嘛。我上去就是一脚。</p>
<ul>
<li>公私有何区别？</li>
</ul>
<p>私钥与公钥作为天造地设的一对，互相可解。看起来没啥区别啊！假如有一钥匙对，一个拿给你，一个拿给我。你加密，我就能解密；我加密，你也能解密。这不是公私不分嘛！其实这个钥匙对中，公私是分明的，你可以自己生成一对，打开看看它们的文本表示，私钥长得多，还可对私钥设置口令。有一个细节是，私钥与公钥加密、解密所用的函数都是不同的，大概 <code>RSA_public_encrypt, RSA_private_decrypt； RSA_private_encrypt, RSA_public_decrypt</code> （上一条的伪代码还是有些瑕疵。）所以，你要是把 私钥 当 公钥 分发出去，自己却留着 公钥 当 私钥，那么就会错误百出。只是，仅仅谈 加解密 这点，公私作用是一样的。</p>
<ul>
<li>丢了怎么办？</li>
</ul>
<p>私钥丢失，比如说你唯一的电脑被儿子弄坏，修不好。恭喜你，你肯定有老婆了。只好重新生成秘钥对了。谁要是用你以前的公钥给你发密信，告诉他用新的公钥即可。</p>
<h2 id="上面扯了这么久，下面我们来谈正事。"><a href="#上面扯了这么久，下面我们来谈正事。" class="headerlink" title="上面扯了这么久，下面我们来谈正事。"></a>上面扯了这么久，下面我们来谈正事。</h2><p>原本打算搞几张图片，活跃一下气氛，表达更形象。不会弄。算了。写到这，才发现，这个话题太大了，我根本驾驭不了。只能简化了。</p>
<ul>
<li><p>加密，我要给老王的老婆发消息，怕别人知道，就用老王的老婆的公钥加密一下，别人拿到也没用，老王的老婆拿到后，用她自己的私钥解密就行了。由此，可以看到，我想发密信给谁，用他的公钥加密后，再发，就比较放心了。</p>
</li>
<li><p>签名，我先用老王的老婆的公钥把消息加密，然后我再用我的私钥加密一次。其他人拿到后，只能用我的公钥解开，大家一看，“哦，这是小李发出来的”，但是看不到我的原文；老王的老婆用我的公钥解密了，心里乐开了花，的确是小李发的，然后用她的私钥再解一次，就能看到内容了。或者，我先用我的私钥加密一次，再用老王的老婆的公钥加密一次，发出去。别人打不开，老王的老婆用私钥解密，再用我的公钥解密，“哦，是小李发来的”。在这里，我的私钥作用就是签名，确实是我（即使不是我，也是我的那个私钥）发出来的消息。实际不是这么用的，一般都是签在摘要上面。</p>
</li>
<li><p>完整性，这里也提一提，毕竟还是容易混淆。想象这样一个场景，我发了 [str, hash(str)]，你收到了，然后自己对str进行了hash，发现没错，那么str就是完整的；即使哪个2B截获了，改成[str’, hash(str’)]，再发给你，你收到了，然后自己对str’进行了hash，还是没错，那么str’就是完整的。哈哈，这就是完整性。但是，情况不是这样的，坏就坏在，我像个傻逼一样，不该把 hash值发给你。我就发个 str给你，你算完hash，打电话（假定电话安全）和我核对一下。这里你可能要问，为啥不加密？因为我仅仅想说一下完整性这个概念，不想谈及安全。就比如，你昨天写了点字符串，你就可以算一个hash值，记在纸上；今天你想看看是不是完整的，有没有被改动，就再对它hash一下，和昨天的纸上记载的对比一下。当在网络上传输的时候，情况就开始复杂了。完整性本来是需要保存正本，然后副本来和正本一一对比；不过那样代价太大了，而hash，比如sha1提供了足够的可靠性，并且效率高啊，所以就用hash值来比较。</p>
</li>
</ul>
<p>可以完全不提人，就画很多的钥匙对，概念可能更准确。但是实际钥匙都是个人或者机构持有的，所以就说成了谁的私钥，谁的公钥。比如 私钥<sub>小明</sub> 和 公钥<sub>小明</sub> 是一对的，如果某天 私钥<sub>小明</sub> 落入到了 大锤 手里，大家可能还不知道。 钥匙确实是配对的，但所属变了。对于签名来说，用 公钥<sub>小明</sub>，解开的一定是 私钥<sub>小明</sub>，我们就认为这个是消息是小明的，没想到却是大锤发的。严谨来说，我们可以说这个消息是 私钥<sub>小明</sub> 持有者发的。不客气的说，公钥<sub>小明</sub> 解开的，就是 私钥<sub>小明</sub> 签名的。具体谁人做的，无法保证，但一般就认为是小明，不排除小明给她老婆共享了 私钥<sub>小明</sub>。</p>
<p>上面简介了三个概念，不过都很理想；当进入到现实的时候，很多问题就要考虑了。首要考虑安全，安全第一嘛！私钥的安全就要靠你自己了。别人要是把刀驾到你的脖子上，那也保不住了。我们只考虑公钥的安全。</p>
<h2 id="理想与现实"><a href="#理想与现实" class="headerlink" title="理想与现实"></a>理想与现实</h2><p>我们也只考虑网络传输（你驱车万里送一个文件，或者通过安全电话一个字节一个字节口读1G的文件给对方，也当我啥也没说）。</p>
<p>我们假设老王是不敢威胁他老婆的，她老婆的私钥是安全的，只有她自己持有。也就是假设每个人的私钥是安全的（如果你被控制人身自由，电脑被控制，身不由己，就当我啥也没说，你也别往下看了；凡事都要满足一定的条件才能成立）。</p>
<p>（TMD，编不下去了）</p>
<p>你拿到了C的公钥，那就一定是C的公钥吗？</p>
<h1 id="未完待续"><a href="#未完待续" class="headerlink" title="未完待续"></a>未完待续</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://lxl1986.github.io/2019/01/03/key-key/" data-id="cjqn2riny00088sv9821dczhr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cryptography/">cryptography</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nginx-proxy" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/28/nginx-proxy/" class="article-date">
  <time datetime="2018-12-28T06:26:06.000Z" itemprop="datePublished">2018-12-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/28/nginx-proxy/">nginx proxy</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天玩弄 aliyun ECS 的时候，在远程机上抄了一个 koa 的例子，哈哈，太不专业了。却不知道如何跑起来。就在网上乱搜一通。简单了解了下nginx 代理，下面谈点我的理解，仅仅是自己思考，没什么全面性和系统性。</p>
<h1 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h1><p>网上的例子。 就拿web访问来说，上谷歌上不去，弄个代理；有时候想隐藏自己的ip，弄个代理。</p>
<p>大概就是 <strong>client</strong> <-> <strong>proxy</strong> <-> <strong>server</strong>，（不管什么路由器，经过了多少网络节点……，只考虑这个三节点）。单看正向代理，第一是关于 <strong>client</strong> 的事情，不管它能不能直接访问 <strong>server</strong>，它都可以选择使用 <strong>proxy</strong>，比如上谷歌，能不能直连，不影响你是否能使用 <strong>proxy</strong>，或许你仅仅是想隐藏什么。第二关于 <strong>proxy</strong> ，它的确需要两头都能连通，它要提供功能，当 <strong>client</strong> 使用了它的时候，发出一个对 <strong>server</strong> 的请求，这时候你使用的 <strong>proxy</strong> 就接管了这个请求；至于是否隐藏 <strong>client</strong> 的IP等信息，就看 <strong>proxy</strong> 是如何实现的，它是可以把 <strong>client</strong> 的IP信息发给 <strong>server</strong> 的。整个流程看起来就是 <strong>client</strong> 访问了 <strong>server</strong>。然而，实际，<strong>client</strong> 只是访问了 <strong>proxy</strong> 而已；或者 <strong>client</strong> 对 <strong>proxy</strong> 说，请帮我访问下 <strong>server</strong>。</-></-></p>
<p>再说一句，连不上谷歌，使用代理服务器，只是正向代理的一个场景。而能连上谷歌，你也可以使用代理服务器，因为你可能想做些私人的事。<strong>client</strong> 在某种程度上糊弄了 <strong>server</strong>。</p>
<h1 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h1><p>比如我访问 <a href="https://www.aliyun.com/xx" target="_blank" rel="noopener">https://www.aliyun.com/xx</a> 和 <a href="https://www.aliyun.com/oo" target="_blank" rel="noopener">https://www.aliyun.com/oo</a> （本故事纯属虚构，如有雷同，纯属巧合！）。我本以为是这样的 <strong>C</strong> <-> <strong>S</strong>。但是实际情况可能是 <strong>C</strong> <-> <strong>P</strong> <-> <strong>S1(xx)</strong>， <strong>C</strong> <-> <strong>P</strong> <-> <strong>S2(oo)</strong> 。其实我访问的是 <strong>P</strong>，它把不同种类的请求分发给了后面不同的服务器。在 <strong>C</strong> <-> <strong>P</strong> 中, 这个 <strong>P</strong> 作为一个反向代理，糊弄了 <strong>C</strong> ，让整个流程变成 <strong>C</strong> <-> <strong>P</strong> <--><strong>Ss</strong>。单看反向代理，就是 <strong>P</strong> 的事情，它会把请求分发到一堆 <strong>Ss</strong>；而 <strong>C</strong> 是不知道的，除非 <strong>P</strong> 愿意泄露点啥。</--></-></-></-></-></-></-></-></p>
<h1 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h1><p>然后就变成了 <strong>C</strong> <-> <strong>P<sub>forward</sub></strong> <-> <strong>P<sub>reverse</sub></strong> <-> <strong>Ss</strong>。 <strong>C</strong> 通过 <strong>P<sub>forward</sub></strong> 糊弄 <strong>P<sub>reverse</sub></strong> ，<strong>P<sub>reverse</sub></strong> 用了一堆 <strong>Ss</strong> 反过来也在糊弄 <strong>P<sub>forward</sub></strong>。 <strong>C</strong> 通过 <strong>P<sub>forward</sub></strong> 以为自己访问了 <strong>P<sub>reverse</sub></strong>，实际 <strong>P<sub>reverse</sub></strong> 却把请求给了 <strong>Ss</strong>。</-></-></-></p>
<h1 id="悲伤"><a href="#悲伤" class="headerlink" title="悲伤"></a>悲伤</h1><p>总想表达更清楚点，奈何几乎能<em>一年无话</em>，撞了南墙也不回头。写东西也是把自己绕进去。</p>
<h1 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h1><p>我在 aliyun ECS，开了 nginx 监听 80 端口，其中 location /hw { proxy_pass <a href="http://127.0.0.1/3456" target="_blank" rel="noopener">http://127.0.0.1/3456</a>; } ，location /danteng { proxy_pass <a href="http://127.0.0.1/6543" target="_blank" rel="noopener">http://127.0.0.1/6543</a>; } ；开了两个 node 应用，一个监听 3456，一个监听 6543。然后 访问 */hw 和 */danteng，就访问了不同的应用，也就是服务吧。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lxl1986.github.io/2018/12/28/nginx-proxy/" data-id="cjqn2rio6000c8sv9s8arl8vr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/server/">server</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-notes-on-async-await" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/24/notes-on-async-await/" class="article-date">
  <time datetime="2018-12-24T03:06:57.000Z" itemprop="datePublished">2018-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/24/notes-on-async-await/">notes on async/await</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>大家好，又到了新一期“扯蛋”时间了。</p>
<p>我几乎没怎么用过 <code>callbacks</code>，<code>promise</code>，<code>generator</code>，<code>yield</code> 这些听起来牛逼哄哄的东西。我直接来看 <code>async/await</code>。有这么多前辈高人，我这小菜就捡了便宜，越过了这一系列发展过程中的酸甜苦辣，直接去偷取“果实”。还有我看<em>CSS</em>的时候，是无视了<strong>IE6</strong>这个可怕时代，直接看<em>CSS3</em>的知识。这也就是大家所说的<strong>速成</strong>，没什么内力，没经历过，就不明白现在为啥是这个样子，不扯了，去吃完<em>扯面</em>再说。</p>
<p>我先是看了<strong>边城</strong>的<a href="https://segmentfault.com/a/1190000007535316" target="_blank" rel="noopener">理解 JavaScript 的 async/await</a>，受益匪浅；接着又找到了<strong>allen_he</strong>的<a href="https://segmentfault.com/a/1190000011296839" target="_blank" rel="noopener">async/await 执行顺序详解</a>，这篇文章就是我想要的，看下面的评论，不管测试结果，我要的就是这篇的解释和这个思路。我瞅了一眼<strong>阮一峰</strong>的<a href="http://www.ruanyifeng.com/blog/2018/02/node-event-loop.html" target="_blank" rel="noopener">Node 定时器详解</a>，这和浏览器中的Event loop还是有很多不同之处，尤其每一轮事件循环中要干的活是大大的不同。</p>
<p>此篇仅仅是一个开始，还需投入精力加深理解。</p>
<ol>
<li>让我们测试几个代码，<strong>学习研究之用</strong>。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"script start..."</span>);</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span><span class="built_in">console</span>.log(<span class="string">"next loop, obviously!"</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ss</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"I'm ss"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"ss"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"test start..."</span>);</span><br><span class="line">	<span class="keyword">const</span> r = <span class="keyword">await</span> ss();</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`r: <span class="subst">$&#123;r&#125;</span>`</span>);	</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"test end..."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve(<span class="string">'how to put a promise to the microtask queue?'</span>).then(<span class="built_in">console</span>.log, <span class="built_in">console</span>.error);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"script end..."</span>);</span><br></pre></td></tr></table></figure>
<p>结果在此，请不要偷看，O(∩_∩)O</p>
<blockquote>
<p>script start…<br>test start…<br>I’m ss<br>script end…<br>r: ss<br>test end…<br>how to put a promise to the microtask queue?<br>next loop, obviously!</p>
</blockquote>
<ol start="2">
<li>略微改动。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"script start..."</span>);</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span><span class="built_in">console</span>.log(<span class="string">"next loop, obviously!"</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">ss</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"I'm ss"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"ss"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"test start..."</span>);</span><br><span class="line">	<span class="keyword">const</span> r = <span class="keyword">await</span> ss();</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`r: <span class="subst">$&#123;r&#125;</span>`</span>);	</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"test end..."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test();</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.resolve(<span class="string">'how to put a promise to the microtask queue?'</span>).then(<span class="built_in">console</span>.log, <span class="built_in">console</span>.error);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"script end..."</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>script start…<br>test start…<br>I’m ss<br>script end…<br>how to put a promise to the microtask queue?<br>r: ss<br>test end…<br>next loop, obviously!</p>
</blockquote>
<h2 id="分析一下"><a href="#分析一下" class="headerlink" title="分析一下"></a>分析一下</h2><p>这两段代码几乎一毛一样。仅仅是 await 那里，第一次等了个 Function call，第二次等了 AsyncFunction call。说白了，第一次等待返回的不是Promise的值 “ss”；第二次等待返回的是一个Promise的值 #value:”ss”, status:”resolved”#。（这里用词不是很准确，比如 Promise的值，你懂得就好。至于第二个值，只是意思意思表示一下，大概就那样子，没有字面量表示法。）</p>
<p>这个 await 还是很骚的。</p>
<ul>
<li><p>第一次，哎呀，是个字符串，不是Promise的值，舍不得交出去，等等吧。跳出了test的执行（注意是跳出去了，暂停了，执行的现场还是保存了）。执行完后面的几句代码，然后搂不住了，await 只好把东西交出来，也就是继续执行。完事，没码可执行，就把 microtask queue 清空了。最后到下一轮task了。</p>
</li>
<li><p>第二次，这货更加过分，因为是个Promise，这货就是不肯交出来。直到 microtask queue 清空了，才知道大势已去，也只能返回这个Promise的值，赶紧执行剩余代码。新的一轮工作又开始了。</p>
</li>
</ul>
<p>简单说就是在 AsyncFunction call 中 await expression, expression的值算出来以后（这里也很讲究，expression的计算，如果放在主线程，还是要卡住，像ajax比较适合，反正不在主线程计算，马上能返回，最后给个结果就行），await 拿到值，现在是不会交出来的；<br>而且还要对别人说：“滚，离我远点。”，没办法，只能暂时跳出这个 AsyncFunction 了。执行后面的代码。完事后，这里也是一个关键点。如果 await 拿的不是一个 Promise的值，那它就要交出来，AsynFunction call得以继续执行，接着清 microtask queue；但如果 await 手里拿的是一个 Promise的值，不管是pending状态还是完蛋状态，都会先清 mircotask queue，它会死皮赖脸的，要等 Promise 计算完后（非pending状态） ，才肯交出那个值，继续从暂停的地方执行。 </p>
<p>当然，这个流程不是 await 控制的，只是把 await 拿到第一人称比较形象。这货就是个拖啊，先拖住再说。 await expression，expression计算出来以后，会有一跳，这就改变了代码的执行流程；待后来，它王者归来，返回胜利的果实。所以，它有自己的适用范围。你确实什么都可以给它 await 一下，但你从这个执行流程也可以看出来，你 await 的任务，如果要在主线程执行，也是没啥卵用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">**含有伪代码，慎重</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">jobs();<span class="comment">//简单任务</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">B2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> p = <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">r</span>=&gt;</span>&#123;</span><br><span class="line">		sleep(一天);</span><br><span class="line">		setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">			sleep(一天);</span><br><span class="line">			r(<span class="string">"呵呵"</span>)</span><br><span class="line">		&#125;,一天)；</span><br><span class="line">	&#125;);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"p: "</span> +p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">B2();</span><br><span class="line"></span><br><span class="line">Steve_Jobs();<span class="comment">//复杂计算</span></span><br><span class="line"><span class="comment">/**/</span></span><br></pre></td></tr></table></figure>
<p>看吧，await 后面的先要睡一天，setTimout就几毫秒吧（我机子，<code>console.time(&#39;sT&#39;);setTimeout(function(){},1000);console.timeEnd(&#39;sT&#39;);</code>，cpu G3220，Chrome71 0.05 ~ 0.13 ms, node v10.4.0 0.06 ~ 0.95 ms，交互式不超过0.1ms，文件式就比较耗时，但也没有超过1ms；仅做参考，机器及环境相关），await拿到Promise（是pending状态）。出去算完 Steve_Jobs。 一天后，setTimeout任务来了，可是它又睡了一天，然后 Promise 就resolved了。此时 p 值才得以打印。流程就是这样。或许浏览器会直接让你滚蛋，他么的什么破代码，想卡死我？。nodejs上我也没有试过。</p>
<p>当然，小弟的栗子不好吃，不太恰当。</p>
<p><em>在下</em>在上篇文章中，也说了，不爱提什么同步异步的。如下片段，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r1 = <span class="keyword">await</span> job1();</span><br><span class="line">r2 = <span class="keyword">await</span> job2(r1);</span><br><span class="line">r3 = <span class="keyword">await</span> job3(r2, r1);</span><br></pre></td></tr></table></figure>
<p>异不异步我不管，你口中的异步任务，还是按次序来。重要的是次序。</p>
<p>不过，<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> r = <span class="keyword">await</span> ajax(some-url); </span><br><span class="line">callback(r);</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure></p>
<p>确实比<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ajax(some-url, callback);</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure></p>
<p>看起来舒服多了。尤其是你安排很多后续任务，才会有真正的优势。本篇的重点是刻画一下 await 这个货。具体怎么使用，我也不会。拜拜，我们下期再见。</p>
<h1 id="刚才又想了想，有些地方不对"><a href="#刚才又想了想，有些地方不对" class="headerlink" title="刚才又想了想，有些地方不对"></a>刚才又想了想，有些地方不对</h1><p>上面吹了那么多牛，后来，我发现，自己不能解释下面的代码，次序都是 step1-&gt;step2-&gt;step3；可是两段代码的互相穿插，穿插的顺序呢？ await 到底和 then 之间有着怎样的爱恨情仇？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">takeLongtime</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">		setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(n + <span class="number">200</span>), n);</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step1</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`step1: <span class="subst">$&#123;n&#125;</span>`</span>);</span><br><span class="line">	<span class="keyword">return</span> takeLongtime(n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step2</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`step2: <span class="subst">$&#123;n&#125;</span>`</span>);</span><br><span class="line">	<span class="keyword">return</span> takeLongtime(n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">step3</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`step3: <span class="subst">$&#123;n&#125;</span>`</span>);</span><br><span class="line">	<span class="keyword">return</span> takeLongtime(n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'sT1'</span>);</span><br><span class="line">step1(<span class="number">400</span>)</span><br><span class="line">	.then(step2)</span><br><span class="line">	.then(step3)</span><br><span class="line">	.then(<span class="function"><span class="params">v</span>=&gt;</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(v);</span><br><span class="line">		<span class="built_in">console</span>.timeEnd(<span class="string">'sT1'</span>);</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">af</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.time(<span class="string">'sT2'</span>);</span><br><span class="line">	<span class="keyword">const</span> n = <span class="number">400</span>;</span><br><span class="line">	<span class="keyword">const</span> r1 = <span class="keyword">await</span> step1(n);</span><br><span class="line">	<span class="keyword">const</span> r2 = <span class="keyword">await</span> step2(r1);</span><br><span class="line">	<span class="keyword">const</span> r3 = <span class="keyword">await</span> step3(r2);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`r3: <span class="subst">$&#123;r3&#125;</span>`</span>);</span><br><span class="line">	<span class="built_in">console</span>.timeEnd(<span class="string">'sT2'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">af();</span><br></pre></td></tr></table></figure>
<p>这里我搞不清的是下面的问题：</p>
<ol>
<li><code>function cb(n) {}; setTimeout(cb, 5000, 1234);</code>，当setTimeout执行了，那么可以认为Timer线程在五秒后会把 <em>cb</em> 及其参数 <em>1234</em> 打入冷宫，不，打入事件队列。主线程有空就执行一下。</li>
<li>那么<br><code>new Promise(r=&gt;{
 setTimeout(()=&gt;r(&quot;呵呵&quot;), 5000)
}).then(console.log, console.error);</code>，它是如何执行的？</li>
</ol>
<ul>
<li>new Promise，首先setTimeout执行了，返回一个 <strong>pending</strong> 状态的 Promise 对象。（五秒后Timer线程会放 <code>()=&gt;r(&#39;呵呵&#39;)</code> 进入事件队列；当主线程执行了这个，Promise对象就会<strong>resolved</strong>，值就是 “呵呵”。）</li>
<li>我想问的是，new Promise这个构造执行完，返回 <strong>pending</strong> 状态的 Promise 对象，然后呢？然后干什么？（离开这里，往下执行？将来再回来？）那后面的then也不能不管吧？既然是 <strong>pending</strong>，那也不能把后面 then 中的两个任务某一个放入 microtask queue 吧？应该是其他线程接管了。这个先放一放。</li>
</ul>
<h1 id="我又来装逼了"><a href="#我又来装逼了" class="headerlink" title="我又来装逼了"></a>我又来装逼了</h1><p><a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html" target="_blank" rel="noopener">老阮的文章</a>，其中还有<strong>朴灵</strong>的批注。啥也不说，看了看评论。只是觉得太浮躁了。细思极恐。披着各种外衣的。打着追求真理的幌子。所谓的概念不是自己的理解吗？不断提升吗？就一下子想得到正确的概念，正确的答案？真能一下子得到<em>正确</em>的概念，这个世界就简单了，还要学习吗？或者，哪有什么真理，你真的想过？写操作系统，写v8的那些人，代码还在不断更新，为啥不是一出来就是完美的？哪些可是真的大神啊。在哥德尔手里，数字能推翻公理化；在我手里也只能加加减减卡里剰几毛钱了。什么是“横看成岭侧成峰”，成天背几个概念，顶个毛用。线程咋咋，进程咋咋，你知道线程怎么表示？数据结构有多少字段？（sorry，我不知道）背那么清楚还不如踢足球？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.isNaN(<span class="built_in">Object</span>)</span><br><span class="line"><span class="built_in">Number</span>.isNaN(<span class="built_in">Object</span>)</span><br><span class="line"><span class="number">2</span>**<span class="number">53</span> === <span class="number">2</span>**<span class="number">53</span> + <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>talk is cheap，show me the code。哈哈。</p>
<h1 id="书是看不完的，得有自己的理解，思维。偷偷打基础，来日可与群雄一战。技术，知识将来才是真正的战场。"><a href="#书是看不完的，得有自己的理解，思维。偷偷打基础，来日可与群雄一战。技术，知识将来才是真正的战场。" class="headerlink" title="书是看不完的，得有自己的理解，思维。偷偷打基础，来日可与群雄一战。技术，知识将来才是真正的战场。"></a>书是看不完的，得有自己的理解，思维。偷偷打基础，来日可与群雄一战。技术，知识将来才是真正的战场。</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://lxl1986.github.io/2018/12/24/notes-on-async-await/" data-id="cjqn2ripp001e8sv9pv9ee6ot" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-sync-and-async" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/21/sync-and-async/" class="article-date">
  <time datetime="2018-12-21T02:36:14.000Z" itemprop="datePublished">2018-12-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/21/sync-and-async/">sync-and-async</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="同步？异步？"><a href="#同步？异步？" class="headerlink" title="同步？异步？"></a>同步？异步？</h1><p>虽然是个菜，但是我还是有话要说。在学JS，等下就分析几个浏览器中JS代码片段。</p>
<p>同步，异步不知道谁翻译的。我书读的不多。可是觉得滥用了。这两个词，哎。我还是没有想的特别清晰。试着谈谈吧。</p>
<h2 id="还得从其他地方说去，long-long-ago…"><a href="#还得从其他地方说去，long-long-ago…" class="headerlink" title="还得从其他地方说去，long long ago…"></a>还得从其他地方说去，long long ago…</h2><ol>
<li>开始你有两只手，你左手码字，右手撸管。（手就是双核，码字，撸管就是进程啥的，脑子来调度。此操作可以是并行的，互不干扰，不行就让别人帮你。当然你也可以并发，去刷牙…）</li>
<li>后来你觉得没有节奏感，应该码一字，撸一下。此时还是并行，不过同步了一下。（什么同步？谁和谁？）</li>
<li>再后来你不小心被小郭妹子断了右手。</li>
<li>你在想该怎么办？</li>
</ol>
<ul>
<li>你左手码完字，然后左手撸啊撸。（单任务）</li>
<li>你左手码一字，左手又去撸一下。（并发了。不过来回切换上下文，也累啊。）</li>
</ul>
<p>说了半天，什么是同步？异步？第二步提到的同步是啥？因为在第二步中，我们为了追求节奏感，可以认为这两个进程或者操作变成了一个大任务。而同步异步应该说的就是一个大任务中的各个小任务之间的执行顺序。我在人民广场吃炸鸡，你在网吧打游戏，这同不同步，异不异步有何用？除非弄成一个任务的两部分。</p>
<h2 id="这里我们要提到层次结构。因为任务是可以细化的。"><a href="#这里我们要提到层次结构。因为任务是可以细化的。" class="headerlink" title="这里我们要提到层次结构。因为任务是可以细化的。"></a>这里我们要提到层次结构。因为任务是可以细化的。</h2><p>一个进程的生命周期中，每个线程一定是按照一定的次序执行的。不管是挨个执行指令，还是分支，循环，跳转……都是按次序的。虽然线程与线程之间看起来没了先后次序，那每个线程内部还是按次序执行。对这些操作系统理论，不清楚。但我坚信，局部是有次序的，它们一定会遵循一定的原则。一堆进程，看起来，乱乱的，但是每个进程内部都是有严格次序的，不会跑过去执行另一个进程空间的指令。就进程内部来说，一堆线程，乱乱的，可是每个线程也是有自己的次序。<strong>次序永存。</strong></p>
<p>直接上码。无码最可耻。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job1</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="string">"job1"</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job2</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="string">"job2"</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job3</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="string">"job3"</span>;&#125;</span><br><span class="line"></span><br><span class="line">job1();<span class="comment">//1</span></span><br><span class="line">job2();<span class="comment">//2</span></span><br><span class="line">job3();<span class="comment">//3</span></span><br></pre></td></tr></table></figure>
<p>这段代码的执行，有次序，1=&gt;2=&gt;3。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job1</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="string">"job1"</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job2</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="string">"job2"</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job3</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="string">"job3"</span>;&#125;</span><br><span class="line"></span><br><span class="line">job1();<span class="comment">//1</span></span><br><span class="line">setTimeout(job2, <span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">1000</span>);<span class="comment">//2</span></span><br><span class="line">job3();<span class="comment">//3</span></span><br></pre></td></tr></table></figure>
<p>这段代码的执行，有次序，1=&gt;2=&gt;3。 job1执行；然后setTimeout执行，这里发生了一件事，它郑重的把job2和86400000交给了Timer线程，然后立马返回一个timeoutID（定时器编号，可使用clearTimeout清除），不过我们没保存这个值；然后job3执行。对吗？线程内还是按次序执行，一步一步来嘛（同步这个词实在让人困惑）。job1=&gt;setTimeout=&gt;job3，不费吹灰之力。大概在第二天的此刻却发生了一个可怕的事情，job2冒了出来（异步这个词也实在让人困惑）。在我看来他们完全是按照次序，即使你把job2放到事件队列，那还是按次序来，job2它自己内部的代码也是按次序在主线程执行。a=&gt;b=&gt;c是次序, b=&gt;a=&gt;c也是次序。job1，job2，job3每个里面都可以再加任务。</p>
<ol>
<li>就算你把第二句换成 <code>ajax(some-url, job2)</code>，还是job1=&gt;ajax=&gt;job3这个次序，（ajax把some-url, job2交给其他线程，立马返回。那个线程干完活，就把job2加到队列）不知啥时候job2会给你来一下。</li>
<li>如果ajax不是立马返回，（浏览器应该是废弃这种用法了），次序就是job1=&gt;ajax-job2=&gt;job3。(ajax-job2, ajax执行，调用job2，ajax返回)</li>
</ol>
<p>如果不是立马返回，还有啥意思，难道要<code>setTimeout(job2, 24*60*60*1000);</code>一直等？不管在现实生活中还是在计算机系统中，都是不合理的！就是要把job2扔到队列中。他们把这种叫异步编程。如今，你可以想办法把它扔到task queue，或者microtask queue。但是话又说回来，当你明白了次序，你也会明白，啥都往队列中塞，也是不好的做法；举个栗子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job1</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> <span class="string">"job1"</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> i=<span class="number">0</span>; </span><br><span class="line">	<span class="keyword">while</span>(i&lt;<span class="built_in">Number</span>.MAX_SAFE_INTEGER)&#123;</span><br><span class="line">		i++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"job2"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">job3</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> <span class="string">"job3"</span>;&#125;</span><br><span class="line"></span><br><span class="line">job1();<span class="comment">//1</span></span><br><span class="line">setTimeout(job2, <span class="number">1000</span>);<span class="comment">//2</span></span><br><span class="line">job3();<span class="comment">//3</span></span><br></pre></td></tr></table></figure>
<p>你把job2扔到队列中也是没用的。到头来，它还是会回到主线程执行，说不定卡死。这种应该新开个Woker线程。</p>
<h2 id="瞎扯事件"><a href="#瞎扯事件" class="headerlink" title="瞎扯事件"></a>瞎扯事件</h2><p>什么是事件。你对着浏览器大喊，“你个2B”，浏览器显示，“滚蛋”。这就是声音事件和浏览器对事件的处理。可惜的是，浏览器不是你实现的，要是你实现的，你想加什么事件都行，你还可以完全不处理鼠标事件。不过，估计也没有什么人会用你的浏览器了。</p>
<p>浏览器中有很多预定义的事件。你点一下鼠标，按一下键盘，都会出事。浏览器这个应用程序也真是复杂啊，操作系统GUI有一套消息机制，浏览器拿到这些消息，又在内部实现了自己的事件机制。一般的应用程序，处理下操作系统的消息就不错了，像win32中的 WM_QUIT……。Windows中的消息，有的消息是不进队列的，有的消息有时候不进有时候进。那看看浏览器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_2b</span>(<span class="params">z</span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">'2B'</span>);&#125;</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'click'</span>, _2b)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	some jobs</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">document</span>.body.click();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	some tasks</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>一般用户都是用鼠标点击页面，_2b入队列。 代码中click函数触发，直接调用 _2b，不入队列。</p>
<p>我现在也没想好下面说啥。但我不怎么喜欢在这里用同步、异步。就是Script执行完，掏空microtask，然后UI善后；再拿一个task，完了掏空microtask，UI善后；……</p>
<p>谁和谁同步，谁和谁异步？晕。把job2放到队列叫异步？那拿到job2执行的时候，不就是同步了？同步的任务，里面没有异步代码？异步的任务，里面没有一句同步代码？两个语句什么关系？两个函数什么关系？两个任务什么关系？两个模块什么关系？你把馒头吃到嘴里，再到胃里。若说这两个是同步任务，那吃到嘴里细分，切牙咬和磨牙磨这小任务是什么关系？我觉得不需要这些伪概念。我觉得JS运行时这个层面，没啥同步、异步，只有Event Loop。所有的任务都遵守着看不见的秩序。</p>
<p><em>未完待续</em></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lxl1986.github.io/2018/12/21/sync-and-async/" data-id="cjqn2rios000o8sv9oo93bfra" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="usage-ssh" class="article article-type-usage" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/21/ssh/" class="article-date">
  <time datetime="2018-12-21T01:17:37.000Z" itemprop="datePublished">2018-12-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/21/ssh/">ssh</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ssh-的一点使用记录"><a href="#ssh-的一点使用记录" class="headerlink" title="ssh 的一点使用记录"></a>ssh 的一点使用记录</h1><p>最近一直玩手游，看小说。估计快<strong>修仙</strong>了。废了。不过也抽空买了个 阿里云ecs，补习JS，准备捣鼓一下。</p>
<h2 id="操作，遂记录如下。"><a href="#操作，遂记录如下。" class="headerlink" title="操作，遂记录如下。"></a>操作，遂记录如下。</h2><ol>
<li>配置不提，系统选的是<em>CentOS</em>。拿到公网IP，（是否通过企业级NAT，管不了那么多了。）能连接就行了。</li>
<li>我怎么弄得root初始密码，也记不清了。哎，拖到今天，不能复现当时情况了。应该是 阿里云的控制台 重置的吧。</li>
</ol>
<ul>
<li>网页也可以登录，从控制台那里找到实例，远程连接。需要输入六位的网页密码，第一次登录会给你。也可以重置，手机验证。然后是网页中的黑屏，输入用户名，密码即可。（似乎在console看到了WebSocket。）</li>
<li>windows下可以用 putty，ssh登录，端口22是默认开启的。如果你当时选系统Windows，可以用远程桌面连接，端口3389默认开启的。</li>
</ul>
<ol start="3">
<li>ssh的密码登录不提，我这里想使用的是 Public Key登录。</li>
</ol>
<ul>
<li>生成秘钥。 安不安全不提，无所谓在哪里生成 秘钥，关键是要拿到自己手里。你可以在自己的机器上生成。我是在密码登录了远程机，然后生成的。<ul>
<li>直接 <code>ssh-keygen</code>，连 -t rsa 都不用。</li>
<li>一路回车，如果你需要给 Private Key 设置密码，你就设置一个记住就行。</li>
<li>完事后就得到 Key Pair（Public Key 和 Private Key），默认就是 .ssh/id_rsa.pub，.ssh/id_rsa 两个文件。 我是在远程机上操作的（不推荐），我把这两文件赶紧弄到我本地机子上藏了起来。</li>
</ul>
</li>
<li>把公钥弄到远程机上。我本来就在远程机上生成的，这一步倒是免了。win7可以用putty带的psftp传。<ul>
<li>在远程机器上，把 id_rsa.pub 放到你的 /home/你的用户名/.ssh文件夹。难道你想放到别人的 .ssh目录中？</li>
<li>然后 把 id_rsa.pub 的内容追加到 authorized_keys 文件中。如果不存在就建立。 <code>touch authorized_keys</code>。操作都在你的 .ssh目录。</li>
<li>可以说就完了。就这么简单。 我然后把id_rsa.pub删除了，这都随你。我也没啥经验。</li>
</ul>
</li>
</ul>
<ol start="4">
<li>远程机的管理员需要设置。</li>
</ol>
<ul>
<li>在<strong>/etc/ssh/sshd_config</strong>，设置PubkeyAuthentication yes。</li>
<li>service sshd reload。 重载ssh服务配置。</li>
</ul>
<blockquote>
<p>普通用户就是上面第3步。没其他多余操作。需要注意的是 .ssh目录的权限要设置为700，authorized_keys文件， u权限rw, g和o权限最多r，设置为600即可。具体man sshd（我没看过）。</p>
</blockquote>
<h2 id="该连接了，我是用的手机"><a href="#该连接了，我是用的手机" class="headerlink" title="该连接了，我是用的手机"></a>该连接了，我是用的手机</h2><ol>
<li>方法一，我就打开了 阿里云app，进入控制台，选择ssh工具，添加主机，设置秘钥对连接，但是死活登录不上去。</li>
<li>方法二，后来，我进入app，控制台，在我的云产品中选择云服务器ECS，右侧的三个小点点，点击有ssh连接，用秘钥对连接，然后就连上了。</li>
<li>从此以后用方法一也可以连上了。</li>
</ol>
<blockquote>
<p>这是什么骚操作，我也理解不了。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lxl1986.github.io/2018/12/21/ssh/" data-id="cjqn2rion000j8sv9matqsd4g" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ssh/">ssh</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-the-coming-plan" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/02/the-coming-plan/" class="article-date">
  <time datetime="2018-08-02T08:27:26.000Z" itemprop="datePublished">2018-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/02/the-coming-plan/">the-coming-plan</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>接下来准备学习一下算法</li>
<li>加强锻炼</li>
<li>时间不多了。尽管已经老了，可我从来没觉得自己老了。也不知道自己这么多年干了什么。东一榔头，西一棒槌。</li>
<li>不怎么喜欢看书。小时候就觉得假东西太多，尤其是政治书，还讨厌背东西。我很多年的想法是宁愿不学，而且害怕学到一堆错误的东西。所以，数学那些还是很喜欢，可惜，我如果不能浏览一遍全书，我是一道题目都不太愿意去做的。这个习惯，就像单身一样，一直保持。搞计算机这几年，也是吃了这个大亏，很少动手去写。<strong>如果克服不了这些，这辈子可能就完了。</strong></li>
<li>啥都没有，就是时间多（闲）。不想白来人世间一趟。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lxl1986.github.io/2018/08/02/the-coming-plan/" data-id="cjqn2riow000q8sv9ksb27bok" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/不知所云/">不知所云</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-runtime-JavaScript" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/19/runtime-JavaScript/" class="article-date">
  <time datetime="2018-07-19T06:49:22.000Z" itemprop="datePublished">2018-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/19/runtime-JavaScript/">runtime-JavaScript</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="别说话，运（wen）行（wo）"><a href="#别说话，运（wen）行（wo）" class="headerlink" title="别说话，运（wen）行（wo）"></a>别说话，运（wen）行（wo）</h2><figure class="highlight javascript"><figcaption><span>wwWorld</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ILoveU = <span class="string">'are you kidding?'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">helloWorld</span>(<span class="params">argc, argv</span>)</span>&#123;</span><br><span class="line"><span class="meta">	"use strict"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> BBC = <span class="string">"2B"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">worldCup2018</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> no10 = <span class="string">"Messi"</span>;		</span><br><span class="line">		<span class="keyword">return</span> BBC;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	worldCup2018();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">helloWorld(<span class="number">1</span>, <span class="string">"holy shit!"</span>);</span><br></pre></td></tr></table></figure>
<p>人狠话不多，直接放狗，噢……放图。想想之前自己的图，也有很多东西不能确定是否准确，但愿你能找到其中正确的，抛弃错误的。欢迎猛喷，只要你更有理，更有证据、实例。</p>
<ol>
<li>这张图，我想做一些简化。</li>
</ol>
<img src="/2018/07/19/runtime-JavaScript/gEC0.png" title="gEC0">
<p>但是，这里有些名字，你是访问不到的，是由JS引擎来使用的。比如浏览器中，全局环境，this===window，但是没有Global（我之前用的Chrome调试器，截图出来，有这个东西，人家调试器就是能访问更多的信息；我就是不行，我就只能调用调用函数、API，抄抄代码）。node中，全局环境，this===global，也没有Global。比如全局环境中JS引擎也维护了一个Scope（或者叫其他名字），你是别指望拿到了。定义的函数的[[Scopes]]，除非JS引擎暴露出来，你也别想访问。这个图，我也不知道怎么画才好。比如这篇文章<a href="http://www.cnblogs.com/TomXu/archive/2012/01/16/2309728.html" target="_blank" rel="noopener">变量对象</a>，就认为：</p>
<blockquote>
<p>全局上下文变量对象GlobalContextVO，(VO === this === global)</p>
</blockquote>
<p>虽然它讲的很多东西都是基于ECMA-262-3的，但是直到现在很多基础的东西还是没变，有的是概念名字变了，猫叫个咪，有的是语法糖，有的的确是发展出了新的东西。同样，全局环境中，<code>Object.getOwnPropertyDescriptor(this, &#39;this&#39;) === undefined</code>，根本没有this这个属性；<strong>this</strong>是keywords，我这图里也不知道把它放哪里！<em>我太心虚了，都不知道在解释什么了。</em></p>
<img src="/2018/07/19/runtime-JavaScript/gEC01.png" title="gEC01 (gEC0 modified)">
<p>我想了想觉得还是这张图好点。</p>
<ol start="2">
<li>啊，不要停……不要停，继续运行，越过首行，一眨眼，就18岁了，不，就到<em>18行</em>了。停！！！</li>
</ol>
<img src="/2018/07/19/runtime-JavaScript/gEC1.png" title="gEC1">
<p>这是越过首行受到的惩罚。</p>
<ol start="3">
<li>尝试越过<em>18行</em>，咦，我擦，怎么跑到第<em>6行</em>咧？</li>
</ol>
<img src="/2018/07/19/runtime-JavaScript/hWEC0.png" title="hWEC0">
<p>注意，现在我们到了<strong>helloWorld-EC</strong>。<code>this: undefined</code>，如果<em>18行</em>是<code>window.helloWorld(1, &quot;holy shit!&quot;);</code>，<code>this: window</code>，你可以用其他对象也无所谓。<em>Scope</em>是个数组形式，第一个元素是<em>Local</em>，第二个元素是<em>Global</em>。（不知道怎么画数组）。<em>Local</em>中有参数值，变量定义，函数定义，还有arguments（这个对象是一个数组形式，包含实际传入的参数值，参数个数……图中没有画清楚，可以说是错误的。arguments[0]和argc之间又微妙的关系。应该画一个图形来表示这个对象，而且它的原型是Object.prototype）。<em>Scope</em>是由当前环境<em>Local</em>和产生当前环境的函数<em>helloWorld</em>的[[Scopes]]（其中恰好含有一个元素<em>Global</em>）构成。</p>
<img src="/2018/07/19/runtime-JavaScript/hWEC01.png" title="hWEC01 (hWEC01 modified)">
<p>我又把这图改进了一下，arguments的__proto__，函数对象的__proto__，prototype也都没有画出来。<br>假设我们从<strong>helloWorld-EC</strong>返回到了<strong>global-EC</strong>，如果返回值是worldCup2018这个函数，并且我们用一个变量接受此值，（返回其他对象也可以，不过如果你返回arguments，接受它，你就arguments那么大块内存；返回函数的话，它的[[Scopes]]大的超乎你的想象！嘿嘿）那么可以看到，虽然我们从<strong>helloWorld-EC</strong>返回到了<strong>global-EC</strong>，虽然<strong>helloWorld-EC</strong>走了，但是worldCup2018依然活着，它的[[Scopes]]所引用的对象当然也在（这涉及到<strong>GarbageColletion</strong>，我也不懂），也就是这块内存还在用，也就是可以访问。</p>
<ol start="4">
<li>既然来了，那就运行第<em>6行</em>。</li>
</ol>
<img src="/2018/07/19/runtime-JavaScript/hWEC1.png" title="hWEC1">
<p>哎，真详（啰）细（嗦）。</p>
<ol start="5">
<li>终于等到你……<em>13</em>多么伟大的数字啊！运行它。又飞到了第<em>9行</em>。</li>
</ol>
<img src="/2018/07/19/runtime-JavaScript/wCEC0.png" title="wCEC0">
<p>注意，现在我们到了<strong>worldCup2018-EC</strong>。<code>this: undefined</code>。<em>Scope</em>是个数组形式。</p>
<ul>
<li>本地环境<em>Local</em>，我画出了<code>no10, arguments</code></li>
<li>另一部分是函数<em>worldCup2018</em>的[[Scopes]]，其中有两个元素。一个是 <strong>helloWorld-EC</strong>的<em>Local</em>环境，一个就是<em>Global</em>。</li>
<li>可以看到<em>Scope</em>中画出去了<strong>三条线</strong>，我这里的画法，没能体现它们之间的顺序关系，真是抱歉。</li>
</ul>
<h2 id="到此为止，往下画也没有意义了。"><a href="#到此为止，往下画也没有意义了。" class="headerlink" title="到此为止，往下画也没有意义了。"></a>到此为止，往下画也没有意义了。</h2><p>至于出栈的时候，一般就是返回到上一层环境合适的位置，比如此被调用函数的下一条语句。（调用函数时，要记得返回的位置。当然这个不是我要考虑的事情。）退到上一层环境时候，内环境中的对象怎么办？如果被引用，就不释放。这些对象，都是在堆上分配的；<strong>Call Stack</strong>也应该是在堆上模拟的。像<strong>C</strong>语言中的函数调用，用栈传参数值，记录返回地址……小弟只能说，干脆直接简洁。因此也没有JS函数很多特性（不能嵌套定义函数啊，啊，啊，啊……）。但是，学好数据结构，照着ECMA-262，就可以用<strong>C</strong>实现JS引擎（这也是小弟努力的目标之一）。就扯到这里吧，太阳都快下山了。下次我们粗解一下<em>立即执行函数</em>。每当调用一个函数，就想想，它的[[Scopes]]是什么，prototype是什么之类的。凡事都有例外，比如<code>new Function(...)</code>产生的函数对象，它的[[Scopes]]只含<em>Global</em>，和产生时所处的环境无关；<code>with</code>语句也会在环境中产生对象，那么此对象的原型是什么？暂时此对象放在哪里？;<code>eval</code>也是很奇特。等有空了，我去网上把答案研究(抄)过来。突然想到克罗地亚没夺冠，不好受。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lxl1986.github.io/2018/07/19/runtime-JavaScript/" data-id="cjqn2rioq000l8sv9wmesv751" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-JavaScript-prototype" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/17/JavaScript-prototype/" class="article-date">
  <time datetime="2018-07-17T00:49:01.000Z" itemprop="datePublished">2018-07-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>►<a class="article-category-link" href="/categories/JavaScript/prototype/">prototype</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/17/JavaScript-prototype/">JavaScript-prototype</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="先了解一点JavaScript知识（复制粘贴大法）"><a href="#先了解一点JavaScript知识（复制粘贴大法）" class="headerlink" title="先了解一点JavaScript知识（复制粘贴大法）"></a>先了解一点JavaScript知识（复制粘贴大法）</h2><ol>
<li><p>ECMAScript is based on several originating technologies, the most well-known being JavaScript (Netscape) and JScript (Microsoft).</p>
</li>
<li><p>ECMAScript is object-based: basic language and host facilities are provided by objects, and an ECMAScript program is a cluster of communicating objects. In ECMAScript, an object is a collection of zero or more properties each with attributes that determine how each property can be used—for example, when the Writable attribute for a property is set to false, any attempt by executed ECMAScript code to assign a different value to the property fails. Properties are containers that hold other objects, primitive values, or functions. A primitive value is a member of one of the following built-in types: Undefined, Null, Boolean, Number, String, and Symbol; an object is a member of the built-in type Object; and a function is a callable object. A function that is associated with an object via a property is called a method.</p>
</li>
<li><p>Even though ECMAScript includes syntax for class definitions, ECMAScript objects are not fundamentally class-based such as those in C++, Smalltalk, or Java. Instead objects may be created in various ways including via a literal notation or via constructors which create objects and then execute code that initializes all or part of them by assigning initial values to their properties. Each constructor is a function that has a property named “prototype” that is used to implement prototype-based inheritance and shared properties. Objects are created by using constructors in new expressions; for example, new Date(2009, 11) creates a new Date object. Invoking a constructor without using new has consequences that depend on the constructor. For example, Date() produces a string representation of the current date and time rather than an object.</p>
</li>
</ol>
<p>Every object created by a constructor has an implicit reference (called the object’s prototype) to the value of its constructor’s “prototype” property. Furthermore, a prototype may have a non-null implicit reference to its prototype, and so on; this is called the prototype chain. When a reference is made to a property in an object, that reference is to the property of that name in the first object in the prototype chain that contains a property of that name. In other words, first the object mentioned directly is examined for such a property; if that object contains the named property, that is the property to which the reference refers; if that object does not contain the named property, the prototype for that object is examined next; and so on.</p>
<ol start="4">
<li>ECMAScript Language Type</li>
</ol>
<ul>
<li>The Undefined Type</li>
<li>The Null Type</li>
<li>The Boolean Type</li>
<li>The String Type</li>
<li>The Symbol Type</li>
<li>The Number Type</li>
<li>The Object Type<br>数据类型就这<em>七种</em>（早些时候没有 The Symbol Type，未来会不会加入其他Type？我说错了你可以来打我）。对我们来说，重要的是值（<strong>Value</strong>），比如undefined，null，true，false，”美女”，{老婆:false}，function 老婆 (many){return “2B”;}。</li>
</ul>
<p>举个栗子，<code>var b = &quot;呵呵&quot;; var bb = new String(&quot;别BB&quot;);</code></p>
<ul>
<li>b，它的值 <code>&quot;呵呵&quot;</code>，是字符串，The String Type。</li>
<li>bb，它的值 <code>{...}</code>，是对象，The Object Type；但是呢，bb[0]=”别”，bb[1]=”B”，bb[2]=”B”，也就是说bb中的”别BB”是字符串，The String Type。</li>
<li>new String中的String仅仅是constructor，和The String Type中的String没毛线关系。</li>
<li>类型转换不小心就会发生，自己得注意到底是什么Type。</li>
</ul>
<h2 id="再说prototype"><a href="#再说prototype" class="headerlink" title="再说prototype"></a>再说prototype</h2><p>网上有张图，很牛逼。 <a href="http://www.mollypages.org/tutorials/js.mp" title="jsobj" target="_blank" rel="noopener">官方网址</a>，里面有大图，可以打印出来。</p>
<img src="/2018/07/17/JavaScript-prototype/jsobj.jpg" title="jsobj">
<p><strong>为毛是这种关系？ <code>typeof Function.prototype === &quot;function&quot;</code>，这又是为毛？</strong></p>
<h2 id="假定我们就运行下面的代码"><a href="#假定我们就运行下面的代码" class="headerlink" title="假定我们就运行下面的代码"></a>假定我们就运行下面的代码</h2><figure class="highlight plain"><figcaption><span>prototype</span><a href="http://www.cnblogs.com/TomXu/archive/2012/01/05/2305453.html" target="_blank" rel="noopener">就用这位前辈的代码</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function Foo() &#123;</span><br><span class="line">    this.value = 42;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Foo.prototype = &#123;</span><br><span class="line">    method: function() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function Bar() &#123;&#125;</span><br><span class="line"></span><br><span class="line">Bar.prototype = new Foo();</span><br><span class="line">Bar.prototype.foo = &apos;Hello World&apos;;</span><br><span class="line"></span><br><span class="line">Bar.prototype.constructor = Bar;</span><br><span class="line"></span><br><span class="line">var test = new Bar();</span><br></pre></td></tr></table></figure>
<ol>
<li>我们处于 <strong>global-EC</strong>，初始化。</li>
</ol>
<img src="/2018/07/17/JavaScript-prototype/globalEC.png" title="globalEC">
<p>图片虽然很丑陋，好歹也是自己画的。有些地方不准确，有些地方有错误。不要在意这些细节（当然也省略了巨多的细节），内存中的对象大概就是这种模样。一般JS引擎都提供了<code>__proto__</code>供大家调试代码。而这形成了一个链条，人称<strong>原型链</strong>。干啥用的？继承。也就是复用代码。</p>
<ol start="2">
<li>现在来执行代码。</li>
</ol>
<ul>
<li>那就是执行第<em>5行</em>，改变了Foo.prototype。 没名字那儿，我就用???代替了。</li>
</ul>
<img src="/2018/07/17/JavaScript-prototype/globalEC1.png" title="globalEC1">
<ul>
<li>再来执行第<em>11行</em>代码。这个<code>new</code>先不考虑，这里会调用特定的方法，当然这里也会产生新的<strong>EC</strong>，并在在里面生成一个新的对象，这个新对象<code>{value: 42, __proto__: Foo.prototype}</code>。当退出这个<strong>EC</strong>后，我们<code>Bar.prototype</code>之前的样子应该是<code>{constructor: Bar, __proto__: Object.prototype}</code>，不过现在换人了；就像第<em>5行</em>那里一样，<code>Foo.prototype</code>的值也换人了。</li>
</ul>
<img src="/2018/07/17/JavaScript-prototype/globalEC2.png" title="globalEC2">
<ul>
<li>接着执行第<em>12行</em>代码。</li>
</ul>
<img src="/2018/07/17/JavaScript-prototype/globalEC3.png" title="globalEC3">
<ul>
<li>接着执行第<em>14行</em>代码。</li>
</ul>
<img src="/2018/07/17/JavaScript-prototype/globalEC4.png" title="globalEC4">
<ul>
<li>最后执行第<em>16行</em>代码。就像第<em>11行</em>，我们还是不考虑<code>new</code>，不考虑这个新的<strong>EC</strong>。现在<code>test</code>就不是<code>undefined</code>了。</li>
</ul>
<img src="/2018/07/17/JavaScript-prototype/globalEC5.png" title="globalEC5">
<p>此时，<code>test.foo, test.value, test.constructor, test.method, test.hasOwnProperty</code>通过原型链都可以使用了。</p>
<p>上篇文章<a href="/2018/07/13/abstract-of-JavaScript/" title="abstract">abstract</a>中，那时候我说 <strong>this</strong> 不重要。<strong>this</strong>是一个<em>keyword</em>，在<code>new Foo()</code>中的<code>this</code>和那时候的<strong>this</strong>用法完全不一样，这里的<code>this</code>和<code>Function.prototype.call, Function.prototype.apply</code>中一样，都是特别提供的。</p>
<p>我们上面的图片，简化，只画出了<strong>global-EC</strong>，其他<strong>EC</strong>没画出来。不过可以看出来，如果我在其他<strong>EC</strong>中定义一个函数，返回此函数。然后我用一个变量接受，那么，虽然此时那个<strong>EC</strong>已经不存在，但是由于我用变量引用了此函数值，那么内存中还是存在这个函数对象，通过它的[[Scopes]]，也能访问消失的<strong>EC</strong>中定义的名字（比如变量名字，函数名字）。很多时候我们用的<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">shit</span>(<span class="params">shit</span>)</span>&#123;...&#125;(<span class="built_in">window</span>))</span><br></pre></td></tr></table></figure></p>
<p>它运行产生一个<strong>EC</strong>，完了退出，但是我们如果在外环境引用了返回值（比如传window进去，把新属性挂在上面），那么虽然此<strong>EC</strong>已退出，但是其中涉及的对象还是存在于内存中。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lxl1986.github.io/2018/07/17/JavaScript-prototype/" data-id="cjqn2rins00068sv9imsz7x1k" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-abstract-of-JavaScript" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/13/abstract-of-JavaScript/" class="article-date">
  <time datetime="2018-07-13T00:51:12.000Z" itemprop="datePublished">2018-07-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>►<a class="article-category-link" href="/categories/JavaScript/execution-context/">execution context</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/13/abstract-of-JavaScript/">abstract-of-JavaScript-???</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote><p>一天不装逼，就难受。本来还想装一下，但是打开 <strong>ecma-262</strong> 自己就绝望了；没有猴年马月不可能看一遍。只好自己举栗子来说明一下<strong>JavaScript</strong>中的原型，作用域……</p>
</blockquote>
<h2 id="栗子（一）"><a href="#栗子（一）" class="headerlink" title="栗子（一）"></a>栗子（一）</h2><figure class="highlight javascript"><figcaption><span>example 1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ILoveU = <span class="string">'are you kidding?'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">helloWorld</span>(<span class="params">argc, argv</span>)</span>&#123;</span><br><span class="line"><span class="meta">	"use strict"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> BBC = <span class="string">"2B"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">worldCup2018</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> no10 = <span class="string">"Messi"</span>;</span><br><span class="line">		<span class="keyword">debugger</span>; <span class="comment">//停在这里，我们随便看看；你用其他方法调试也可以。</span></span><br><span class="line">		<span class="keyword">return</span> BBC;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	worldCup2018();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">null</span>;<span class="comment">//不小心把这句删除了，后面截图注意这里，无大碍。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">helloWorld(<span class="number">1</span>, <span class="string">"holy shit!"</span>);</span><br></pre></td></tr></table></figure>
<p>这里不会用什么奇技淫巧，注重基本概念的理解。我不会定义一个这个的函数 <code>function shit(shit){var shit; return shit;}</code>。这<strong>ecma-262</strong>发展太快了。不断有新的特性加入，还有概念上的改名。先有个简单的理解，以后再慢慢细化。</p>
<p>我们让<strong>栗子（一）</strong>跑起来，用Chrome <em>【版本 67.0.3396.99（正式版本） （64 位）】</em>吧，我觉得灰常好用（我搞不懂，IE11在win7上跑，反正很难用，我也不想截图了）。</p>
<p>先粗略的过一遍，直观的感受一下。</p>
<ol>
<li>我们第一个要看的就是 Call Stack<img src="/2018/07/13/abstract-of-JavaScript/Call%20Stack.png" title="Call Stack">
</li>
</ol>
<p>在 <strong>Call Stack</strong> 中，最底下的(anonymous)就是大伙说的 global Execution Context，我们的源代码就在这里面运行。其中定义一个变量，一个函数，然后到了 <em>19行</em>，调用了helloWorld，就产生了新的 helloWord-EC；里面定义了一个”2B”变量，一个函数，再到<em>14行</em>调用了worldCup2018，产生了worldCup2018-EC。</p>
<p>这种Stack数据结构哪里都有它的身影，什么push，pop……</p>
<p>瞅了一眼<strong>ecma-262</strong>，哎，真是复杂……你只要记住，调用函数就会产生一个新的数据结构<strong>EC</strong>就得了（至于第一个global-EC怎么产生的？还有没有其他方法产生？我们后面会有所涉及）。</p>
<blockquote>
<p>爱因斯坦：「如果你无法向6岁小孩解释它，那代表你自己也不明白。」<br>对这句话，我是深表怀疑。老爱真的说过？鸡汤喝多了，不好。该下功夫的地方还是自己出力，我还想一个月让小孩长到20岁那么大呢。谈不上什么对错，<strong>看山是山，看山不是山，看山还是山</strong>，不多说了。 </p>
</blockquote>
<ol start="2">
<li>假设，我们让代码停在第一行（怎么停？踩刹车啊！自己去改改）。我有句话不知当讲不当讲？这个点，其实挺重要的。此时已经进入了global-EC。但是在进入之前，V8（或者其他引擎）会创建好 <strong>global object</strong>（到底怎么弄的？我也不知道，或许我说的就是错的，但是 global object 得有）。这是什么东东？<br>简单说，<strong>global object</strong>上面挂了很多东西，比如 <code>Infinity，NaN，parseInt，Number，Object，Map，Promise……</code>。记住，是在执行代码之前创建的<strong>global object</strong>。管你有没有代码，都有这东西。浏览器执行你的代码，产生<strong>global-EC</strong>，上面说了这是一个重要的数据结构，要存很多值。情况没有我们想的那么简单，但是复杂的情况我们不考虑，呵呵（不管你我理解对错，你我的代码都能运行，或许还很完美。你没养过猪，但是会吃红烧肉啊！）。</li>
</ol>
<p><del>3. <em>fuck <em>ecma-262</em></em>。我们还是来说<strong>global-EC</strong>，我们只看<em>Realm</em>部分。</del><br><del>&gt; Before it is evaluated, all ECMAScript code must be associated with a realm. Conceptually, a realm consists of a set of intrinsic objects, an ECMAScript global environment, all of the ECMAScript code that is loaded within the scope of that global environment, and other associated state and resources.</del><br><del>把 <strong>global object</strong>挂上去， <strong>global Environment Record</strong>也挂上去。</del><br>我他妈还以为自己在实现<strong>ecma-262</strong>呢！</p>
<ol start="3">
<li>看着我们的代码，我们还是来说<strong>global-EC</strong>，（我不知道<strong>EC</strong>这个数据结构各个部分该叫什么名字，网上有叫VariableObject/ActiveObject，ScopeChain，thisValue的）。我也不打算起什么名字了。放个图，看吧。<img src="/2018/07/13/abstract-of-JavaScript/gEC1.png" title="gEC1">
</li>
</ol>
<img src="/2018/07/13/abstract-of-JavaScript/gEC2.png" title="gEC2">
<img src="/2018/07/13/abstract-of-JavaScript/gEC3.png" title="gEC3">
<p>此时Scope里面就一个Global，Global上挂了<strong>global object</strong>，还有各种乱七八糟的属性；注意<code>ILoveU: undefined</code> 和 <code>helloWorld: f helloWorld(argc, argv)</code>。此时我们的代码还在第一行。这也就是进入EC的时候，初始化阶段；然后才是执行代码。（明白这两个阶段，你就能明白什么时候一个名字绑定了你所期望的值。）</p>
<ul>
<li>初始化阶段，把var，FD都存入当前环境，也就是Scope的Global中。var的变量<code>ILoveU</code>，名字存进去，值是undefined。FD <code>helloWorld</code>名字也存进去，值就是一个函数对象。（FD、FE、NFE、FS自便查找）（注意：Scope，GLobal是当前我用的调试器中的。不必在意这些名字。只需记住有个数据结构存储环境即可。就是你一眼看过全局代码，有些名字需要存起来。）<code>this</code>被设置为 Global，此时就是window。</li>
</ul>
<p>Scope，这个词，我不知道为什么很多地方都叫作用域。我还是觉得环境更准确。任何程序的运行，都必须有外界提供一个初始环境。硬件给操作系统提供，操作系统给各种游戏、浏览器提供，浏览器给JS代码提供。不管是外环境还是内环境，都是事物发展所必须的。你说个人名“王麻子”，你的小伙伴就知道你在说“隔壁老王”，而不是说公元前666年的老王；小伙伴们都默认了一个小环境；如果没有环境，什么都说不清。当然，如果你隔壁两边都住的“王麻子”，就需要提供更多的信息，才能区分你说的左隔壁还是右隔壁老王。</p>
<img src="/2018/07/13/abstract-of-JavaScript/hW.png" title="helloWorld function">
<p>还有一点很重要，我们点击看到<code>helloWorld</code>，能看到[[Scopes]]。这个是干啥用的？先不管干啥用的，它的值，记录了定义时环境。<code>helloWord</code>哪里定义的，<strong>global-EC</strong>中啊，所以它的[[Scopes]]值就是<strong>global-EC</strong>的Scope，这里是含有一个元素的数组的形式，也就是[Global]。</p>
<ul>
<li>执行阶段，好的，那我就一步一步执行即可。第一行代码，执行完毕。<code>ILoveU: &quot;are you kidding?&quot;</code>；然后就到了<em>17行</em> <code>helloWorld(1, &quot;holy shit!&quot;);</code> ，那么我们继续执行。欧，我们进入<strong>helloWord-EC</strong>了。</li>
</ul>
<img src="/2018/07/13/abstract-of-JavaScript/gEC4.png" title="gEC4">
<h2 id="我们不扯乱七八糟的名称了。直接撸代码。"><a href="#我们不扯乱七八糟的名称了。直接撸代码。" class="headerlink" title="我们不扯乱七八糟的名称了。直接撸代码。"></a>我们不扯乱七八糟的名称了。直接撸代码。</h2><ol start="4">
<li>那我们就来看看<strong>helloWord-EC</strong>。</li>
</ol>
<img src="/2018/07/13/abstract-of-JavaScript/hWEC.png" title="helloWorldEC">
<img src="/2018/07/13/abstract-of-JavaScript/hWEC1.png" title="helloWorldEC1">
<ul>
<li><p>初始化阶段，这个是函数调用产生的EC，比<strong>global-EC</strong>多了参数，但还是要构建环境。在局部环境Local里存<code>argc: 1, argv: &quot;holy shit!&quot;, BBC: undefined, worldCup2018: f worldCup2018(), this: undefined</code>，实际应该还有arguments对象，不过Chrome浏览器显示的数据应该都是优化过的。（后面会稍稍提及。）<code>helloWord</code>产生了Local，再加<code>helloWord</code>的[[Scopes]]共同构成了此时的Scope。注意，我用了<code>&quot;use strict&quot;;</code>，就是不想过多涉及<code>this</code>，我觉得 <strong>this</strong> is not important, at least for now, it’s irrelevant. 如果没有strict，this会被设置为window。 <code>worldCup2018</code>的[[Scopes]]就是<strong>helloWord-EC</strong>的Scope，也就是[Closure (helloWorld), Global]。</p>
</li>
<li><p>执行阶段，走一步瞧瞧，<code>BBC: &quot;2B&quot;</code>，我们又来到了<em>14行</em><code>worldCup2018();</code>，没啥可说的，继续走起。</p>
</li>
</ul>
<img src="/2018/07/13/abstract-of-JavaScript/hWEC2.png" title="helloWorldEC2">
<ol start="5">
<li>那我们就来看看<strong>worldCup2018-EC</strong>。</li>
</ol>
<img src="/2018/07/13/abstract-of-JavaScript/wCEC.png" title="worldCup2018EC">
<ul>
<li><p>初始化阶段，初始化局部环境Local，外加它自己（<code>worldCup2018</code>）的[[Scopes]]，构成此时的Scope。你或许很纳闷，<code>Closure (helloWorld)</code>里面只有一个<code>BBC: &quot;2B&quot;</code>，其实这里应该是最少显示了，显示多余的没卵用。worldCup2018有一句<code>return BBC</code>，仅仅用到了<code>Closure (helloWorld)</code>中的<code>BBC</code>，如果用到了 helloWorld的argc，这里也会显示；如果连<code>BBC</code>也没有用到，Chrome这里就不会有<code>Closure (helloWorld)</code>，直接优化掉了。因为此时，<code>Closure (helloWorld)</code>对worldCup2018来说就是多余的，但是挂在那里也是可以的。（比如你在worldCup2018里面再定义一个函数并且此函数用到了BBC，再调用一下此函数，那么<code>Closure (helloWorld)</code>对worldCup2018就不能优化掉。）</p>
</li>
<li><p>执行阶段，没什么可说的。</p>
</li>
</ul>
<img src="/2018/07/13/abstract-of-JavaScript/wCEC1.png" title="worldCup2018EC1">
<img src="/2018/07/13/abstract-of-JavaScript/wCreturn.png" title="worldCup return">
<h2 id="我们该回去了。没必要再定义66层函数了。三层，我都感觉多了。我脑子不够用。"><a href="#我们该回去了。没必要再定义66层函数了。三层，我都感觉多了。我脑子不够用。" class="headerlink" title="我们该回去了。没必要再定义66层函数了。三层，我都感觉多了。我脑子不够用。"></a>我们该回去了。没必要再定义66层函数了。三层，我都感觉多了。我脑子不够用。</h2><p>注意看 Call Stack。<br><img src="/2018/07/13/abstract-of-JavaScript/wCECdie.png" title="worldCup die"></p>
<p>Look，我们退出了<strong>worldCup2018-EC</strong>。时间不早了，继续走。</p>
<img src="/2018/07/13/abstract-of-JavaScript/hWECdie.png" title="helloWorld die">
<p>退出了<strong>helloWord-EC</strong>。</p>
<img src="/2018/07/13/abstract-of-JavaScript/gECdie.png" title="global die">
<p>退出了<strong>global-EC</strong>（<strong>global-EC</strong>应该是程序关闭了才退出。调试器在这里插了一脚，这里应该与调试有关）。</p>
<p>回家吃饭吧。<br>本来打算几句话讲讲prototype，scope。到现在却感觉<strong>Call Stack</strong>，尤其<strong>EC</strong>都说的很乱。改天补充吧。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lxl1986.github.io/2018/07/13/abstract-of-JavaScript/" data-id="cjqn2ripo001d8sv92yq58w68" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/execution-context/">execution context</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/prototype/">prototype</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cryptography/">cryptography</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/height/">height</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selector/">selector</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/server/">server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/viewport/">viewport</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/不知所云/">不知所云</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/cryptography/" style="font-size: 10px;">cryptography</a> <a href="/tags/css/" style="font-size: 16.67px;">css</a> <a href="/tags/height/" style="font-size: 10px;">height</a> <a href="/tags/selector/" style="font-size: 10px;">selector</a> <a href="/tags/server/" style="font-size: 10px;">server</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/viewport/" style="font-size: 10px;">viewport</a> <a href="/tags/不知所云/" style="font-size: 13.33px;">不知所云</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/01/07/funargs/">funargs</a>
          </li>
        
          <li>
            <a href="/2019/01/03/key-key/">key? key!</a>
          </li>
        
          <li>
            <a href="/2018/12/28/nginx-proxy/">nginx proxy</a>
          </li>
        
          <li>
            <a href="/2018/12/24/notes-on-async-await/">notes on async/await</a>
          </li>
        
          <li>
            <a href="/2018/12/21/sync-and-async/">sync-and-async</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 李小利<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>